# Logfile created on Sat Aug 21 05:52:29 +0530 2010 by logger.rb/22285
  [1m[36mSQL (0.4ms)[0m  [1mSHOW TABLES[0m
  [1m[35mSQL (6.5ms)[0m  DROP TABLE `categories`
  [1m[36mSQL (46.8ms)[0m  [1mCREATE TABLE `categories` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `name` varchar(255), `parent_id` int(11), `lft` int(11), `rgt` int(11), `organization_id` int(11)) ENGINE=InnoDB[0m
  [1m[35mSQL (0.3ms)[0m  SHOW TABLES
  [1m[36mSQL (1.4ms)[0m  [1mDROP TABLE `departments`[0m
  [1m[35mSQL (6.6ms)[0m  CREATE TABLE `departments` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `name` varchar(255)) ENGINE=InnoDB
  [1m[36mSQL (0.9ms)[0m  [1mSHOW TABLES[0m
  [1m[35mSQL (1.3ms)[0m  DROP TABLE `notes`
  [1m[36mSQL (7.6ms)[0m  [1mCREATE TABLE `notes` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `body` text, `parent_id` int(11), `lft` int(11), `rgt` int(11), `notable_id` int(11), `notable_type` varchar(255)) ENGINE=InnoDB[0m
  [1m[35mSQL (0.3ms)[0m  SHOW TABLES
  [1m[36mSQL (1.2ms)[0m  [1mDROP TABLE `renamed_columns`[0m
  [1m[35mSQL (21.5ms)[0m  CREATE TABLE `renamed_columns` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `name` varchar(255), `mother_id` int(11), `red` int(11), `black` int(11)) ENGINE=InnoDB
  [1m[36mSQL (0.3ms)[0m  [1mSHOW TABLES[0m
  [1m[35mSQL (0.3ms)[0m  SELECT version FROM `schema_migrations`
Unable to load category, underlying cause No such file to load -- category 

 /home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:284:in `depend_on'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:196:in `require_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:850:in `try_to_load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:865:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:845:in `fixtures'
./test/test_helper.rb:31
./test/awesome_nested_set_test.rb:1:in `require'
./test/awesome_nested_set_test.rb:1
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
Unable to load note, underlying cause No such file to load -- note 

 /home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:284:in `depend_on'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:196:in `require_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:850:in `try_to_load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:865:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:845:in `fixtures'
./test/test_helper.rb:31
./test/awesome_nested_set_test.rb:1:in `require'
./test/awesome_nested_set_test.rb:1
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
Unable to load department, underlying cause No such file to load -- department 

 /home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:284:in `depend_on'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:196:in `require_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:850:in `try_to_load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:865:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:845:in `fixtures'
./test/test_helper.rb:31
./test/awesome_nested_set_test.rb:1:in `require'
./test/awesome_nested_set_test.rb:1
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
Unable to load category, underlying cause No such file to load -- category 

 /home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:284:in `depend_on'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:196:in `require_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:850:in `try_to_load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:865:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:845:in `fixtures'
./test/awesome_nested_set/helper_test.rb:8
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:215:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:215:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:205:in `load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:570:in `new_constants_in'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:205:in `load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:215:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.4ms)[0m  SHOW TABLES
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) AND (`categories`.id != 4) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.8ms)[0m  describe `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Child', NULL, 3, 14)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 7) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 7 AND 12 THEN `lft` + 14 - 12 WHEN `lft` BETWEEN 13 AND 14 THEN `lft` + 7 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 7 AND 12 THEN `rgt` + 14 - 12 WHEN `rgt` BETWEEN 13 AND 14 THEN `rgt` + 7 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 7 THEN 3 ELSE `parent_id` END 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 7) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `parent_id` = 5 WHERE (`categories`.`id` = 4)
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 5 AND 6 THEN `lft` + 8 - 6 WHEN `lft` BETWEEN 7 AND 8 THEN `lft` + 5 - 7 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 5 AND 6 THEN `rgt` + 8 - 6 WHEN `rgt` BETWEEN 7 AND 8 THEN `rgt` + 5 - 7 ELSE `rgt` END, `parent_id` = CASE WHEN id = 4 THEN 5 ELSE `parent_id` END [0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.6ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'New Root', NULL, NULL, 14)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `parent_id` = NULL WHERE (`categories`.`id` = 4)
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 1 AND 4 THEN `lft` + 6 - 4 WHEN `lft` BETWEEN 5 AND 6 THEN `lft` + 1 - 5 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 1 AND 4 THEN `rgt` + 6 - 4 WHEN `rgt` BETWEEN 5 AND 6 THEN `rgt` + 1 - 5 ELSE `rgt` END, `parent_id` = CASE WHEN id = 4 THEN NULL ELSE `parent_id` END 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Child', NULL, 3, 14)
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 9) LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 7 AND 12 THEN `lft` + 14 - 12 WHEN `lft` BETWEEN 13 AND 14 THEN `lft` + 7 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 7 AND 12 THEN `rgt` + 14 - 12 WHEN `rgt` BETWEEN 13 AND 14 THEN `rgt` + 7 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 9 THEN 3 ELSE `parent_id` END [0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 9) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `parent_id` = 5 WHERE (`categories`.`id` = 4)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 5 AND 6 THEN `lft` + 8 - 6 WHEN `lft` BETWEEN 7 AND 8 THEN `lft` + 5 - 7 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 5 AND 6 THEN `rgt` + 8 - 6 WHEN `rgt` BETWEEN 7 AND 8 THEN `rgt` + 5 - 7 ELSE `rgt` END, `parent_id` = CASE WHEN id = 4 THEN 5 ELSE `parent_id` END 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 1 AND 3 THEN `lft` + 7 - 3 WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 1 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 1 AND 3 THEN `rgt` + 7 - 3 WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 1 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN NULL ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `parent_id` = 3 WHERE (`categories`.`id` = 5)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 7 AND 7 THEN `lft` + 9 - 7 WHEN `lft` BETWEEN 8 AND 9 THEN `lft` + 7 - 8 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 7 AND 7 THEN `rgt` + 9 - 7 WHEN `rgt` BETWEEN 8 AND 9 THEN `rgt` + 7 - 8 ELSE `rgt` END, `parent_id` = CASE WHEN id = 5 THEN 3 ELSE `parent_id` END 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.9ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
WARNING: Can't mass-assign protected attributes: lft, rgt
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Child', NULL, 3, 14)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 10) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 7 AND 12 THEN `lft` + 14 - 12 WHEN `lft` BETWEEN 13 AND 14 THEN `lft` + 7 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 7 AND 12 THEN `rgt` + 14 - 12 WHEN `rgt` BETWEEN 13 AND 14 THEN `rgt` + 7 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 10 THEN 3 ELSE `parent_id` END 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 10) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (5.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`renamed_columns`.`black`) AS max_id FROM `renamed_columns`
  [1m[36mSQL (0.7ms)[0m  [1mdescribe `renamed_columns`[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `renamed_columns` (`black`, `mother_id`, `name`, `red`) VALUES (2, NULL, NULL, 1)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  DELETE FROM `categories` WHERE (`categories`.`lft` > 4 AND `categories`.`rgt` < 7)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = (`lft` - 4) WHERE (`lft` > 7)[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `rgt` = (`rgt` - 4) WHERE (`rgt` > 7)
  [1m[36mSQL (0.5ms)[0m  [1mDELETE FROM `categories` WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'lawyers', NULL, NULL, 14)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (15, 'United States', NULL, NULL, 16)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 11) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 12) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 14 AND 14 THEN `lft` + 16 - 14 WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 14 - 15 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 14 AND 14 THEN `rgt` + 16 - 14 WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 14 - 15 ELSE `rgt` END, `parent_id` = CASE WHEN id = 12 THEN 11 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 11) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 12) LIMIT 1[0m
  [1m[35mSQL (13.8ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (17, 'Patent Law', NULL, NULL, 18)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 12) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 13) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 18 - 16 WHEN `lft` BETWEEN 17 AND 18 THEN `lft` + 15 - 17 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 18 - 16 WHEN `rgt` BETWEEN 17 AND 18 THEN `rgt` + 15 - 17 ELSE `rgt` END, `parent_id` = CASE WHEN id = 13 THEN 12 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 12) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 13) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 11) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.parent_id = 11)
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.parent_id = 12)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` >= 13 AND `categories`.`rgt` <= 18) AND (`categories`.id != 11)
  [1m[36mSQL (1.0ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 4 AND `categories`.`rgt` <= 7) AND (`categories`.id != 3) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.3ms)[0m  DELETE FROM `categories` WHERE (`categories`.`id` = 4)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = (`lft` - 4) WHERE (`lft` > 7)[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `rgt` = (`rgt` - 4) WHERE (`rgt` > 7)
  [1m[36mSQL (0.2ms)[0m  [1mDELETE FROM `categories` WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 4 AND `categories`.`rgt` <= 7) AND (`categories`.id != 3) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.3ms)[0m  DELETE FROM `categories` WHERE (`categories`.`id` = 4)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = (`lft` - 4) WHERE (`lft` > 7)[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `rgt` = (`rgt` - 4) WHERE (`rgt` > 7)
  [1m[36mSQL (0.2ms)[0m  [1mDELETE FROM `categories` WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'New Top', NULL, NULL, 14)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 14) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 1 AND 10 THEN `lft` + 13 - 10 WHEN `lft` BETWEEN 11 AND 13 THEN `lft` + 1 - 11 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 1 AND 10 THEN `rgt` + 13 - 10 WHEN `rgt` BETWEEN 11 AND 13 THEN `rgt` + 1 - 11 ELSE `rgt` END, `parent_id` = CASE WHEN id = 1 THEN 14 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 14) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (10.0ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) ORDER BY `categories`.`lft`
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`name` = 'Child 1') LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Child 1.1', NULL, NULL, 14)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (15, 'Child 1.1.1', NULL, NULL, 16)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (17, 'Child 1.1.1.1', NULL, NULL, 18)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (19, 'Child 1.2', NULL, NULL, 20)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.9ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 15) LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 3 AND 12 THEN `lft` + 14 - 12 WHEN `lft` BETWEEN 13 AND 14 THEN `lft` + 3 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 3 AND 12 THEN `rgt` + 14 - 12 WHEN `rgt` BETWEEN 13 AND 14 THEN `rgt` + 3 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 15 THEN 2 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 15) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 15) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 16) LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 4 AND 14 THEN `lft` + 16 - 14 WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 4 - 15 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 4 AND 14 THEN `rgt` + 16 - 14 WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 4 - 15 ELSE `rgt` END, `parent_id` = CASE WHEN id = 16 THEN 15 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 15) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 16) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 16) LIMIT 1[0m
  [1m[35mCategory Load (0.2ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 17) LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 5 AND 16 THEN `lft` + 18 - 16 WHEN `lft` BETWEEN 17 AND 18 THEN `lft` + 5 - 17 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 5 AND 16 THEN `rgt` + 18 - 16 WHEN `rgt` BETWEEN 17 AND 18 THEN `rgt` + 5 - 17 ELSE `rgt` END, `parent_id` = CASE WHEN id = 17 THEN 16 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 16) LIMIT 1[0m
  [1m[35mCategory Load (0.2ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 17) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 18) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 9 AND 18 THEN `lft` + 20 - 18 WHEN `lft` BETWEEN 19 AND 20 THEN `lft` + 9 - 19 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 9 AND 18 THEN `rgt` + 20 - 18 WHEN `rgt` BETWEEN 19 AND 20 THEN `rgt` + 9 - 19 ELSE `rgt` END, `parent_id` = CASE WHEN id = 18 THEN 2 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 18) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 18) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (1.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 1) LIMIT 1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mNote Load (0.1ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 1) LIMIT 1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 2) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.parent_id = 4)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.parent_id = 3)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.parent_id = 1)[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mScopedCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1
  [1m[36mScopedCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft` LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `organization_id` = 0 WHERE (`categories`.`id` = 2)
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mScopedCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1[0m
  [1m[35mScopedCategory Load (0.4ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft` LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `organization_id` = 0 WHERE (`categories`.`id` = 2)[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (rgt - lft = 1)[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`rgt` - `lft` = 1) ORDER BY `lft`
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`rgt` - `lft` = 1)[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`rgt` - `lft` = 1) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`rgt` - `lft` = 1) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`rgt` - `lft` = 1) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`rgt` - `lft` = 1) ORDER BY `lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = NULL WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `rgt` = NULL WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mSQL (3.8ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 12 WHERE (`categories`.`id` = 6)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mSQL (0.8ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 1 WHERE (`categories`.`id` = 3)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (10.1ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `rgt` = 10 WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mSQL (0.6ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.7ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` < 4) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 5) AND (`categories`.`lft` < 8) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 2) AND (`categories`.`lft` < 2) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) AND (`categories`.id != 1) AND (`categories`.`lft` < 1) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 3) AND (`categories`.id != 4) AND (`categories`.`lft` < 5) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 2)[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) AND (`categories`.id != 4)[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` < 4) ORDER BY `categories`.`lft` DESC LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 3 THEN `lft` + 7 - 3 WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 2 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 3 THEN `rgt` + 7 - 3 WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 2 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN 1 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` < 2) ORDER BY `categories`.`lft` DESC LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` > 2) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.7ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.6ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) AND (`categories`.id != 1) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` > 4) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 9 - 7 WHEN `lft` BETWEEN 8 AND 9 THEN `lft` + 4 - 8 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 9 - 7 WHEN `rgt` BETWEEN 8 AND 9 THEN `rgt` + 4 - 8 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN 1 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` > 6) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` < 6) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Node-1', NULL, NULL, 14)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (15, 'Node-2', NULL, NULL, 16)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (17, 'Node-3', NULL, NULL, 18)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 19) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 20) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 14 AND 14 THEN `lft` + 16 - 14 WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 14 - 15 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 14 AND 14 THEN `rgt` + 16 - 14 WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 14 - 15 ELSE `rgt` END, `parent_id` = CASE WHEN id = 20 THEN 19 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 19) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 20) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 19) LIMIT 1[0m
  [1m[35mCategory Load (0.2ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 21) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 16 AND 16 THEN `lft` + 18 - 16 WHEN `lft` BETWEEN 17 AND 18 THEN `lft` + 16 - 17 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 16 AND 16 THEN `rgt` + 18 - 16 WHEN `rgt` BETWEEN 17 AND 18 THEN `rgt` + 16 - 17 ELSE `rgt` END, `parent_id` = CASE WHEN id = 21 THEN 19 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 19) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 21) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` DESC LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 13 AND `categories`.`rgt` <= 18) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 14 AND `categories`.`rgt` >= 15) AND (`categories`.id != 20)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 16 AND `categories`.`rgt` >= 17) AND (`categories`.id != 21)
  [1m[36mSQL (0.6ms)[0m  [1mUPDATE `categories` SET lft = null, rgt = null [0m
  [1m[35mCategory Load (0.6ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 1 ) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 2 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 2, `rgt` = 3 WHERE (`categories`.`id` = 2)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 3 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 4 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.6ms)[0m  UPDATE `categories` SET `lft` = 5, `rgt` = 6 WHERE (`categories`.`id` = 4)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 4, `rgt` = 7 WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 5 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 8, `rgt` = 9 WHERE (`categories`.`id` = 5)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 1, `rgt` = 10 WHERE (`categories`.`id` = 1)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.6ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 6 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 11, `rgt` = 12 WHERE (`categories`.`id` = 6)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 19 ) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 20 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 14, `rgt` = 15 WHERE (`categories`.`id` = 20)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 21 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 16, `rgt` = 17 WHERE (`categories`.`id` = 21)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 13, `rgt` = 18 WHERE (`categories`.`id` = 19)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` DESC LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 13 AND `categories`.`rgt` <= 18) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 14 AND `categories`.`rgt` >= 15) AND (`categories`.id != 20)
  [1m[36mSQL (0.7ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 16 AND `categories`.`rgt` >= 17) AND (`categories`.id != 21)[0m
  [1m[35mSQL (1.4ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Root1', NULL, NULL, 14)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.6ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (15, 'Root2', NULL, NULL, 16)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (17, 'Root3', NULL, NULL, 18)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 22) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 23) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 14 AND 14 THEN `lft` + 16 - 14 WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 14 - 15 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 14 AND 14 THEN `rgt` + 16 - 14 WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 14 - 15 ELSE `rgt` END, `parent_id` = CASE WHEN id = 23 THEN 22 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 22) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 23) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 22) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 24) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 16 AND 16 THEN `lft` + 18 - 16 WHEN `lft` BETWEEN 17 AND 18 THEN `lft` + 16 - 17 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 16 AND 16 THEN `rgt` + 18 - 16 WHEN `rgt` BETWEEN 17 AND 18 THEN `rgt` + 16 - 17 ELSE `rgt` END, `parent_id` = CASE WHEN id = 24 THEN 22 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 22) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 24) LIMIT 1[0m
  [1m[35mCategory Load (0.6ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` DESC LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 13 AND `categories`.`rgt` <= 18) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 14 AND `categories`.`rgt` >= 15) AND (`categories`.id != 23)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 16 AND `categories`.`rgt` >= 17) AND (`categories`.id != 24)[0m
  [1m[35mSQL (0.5ms)[0m  UPDATE `categories` SET lft = null, rgt = null 
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 1 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 2 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 2, `rgt` = 3 WHERE (`categories`.`id` = 2)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 3 ) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 4 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 5, `rgt` = 6 WHERE (`categories`.`id` = 4)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 4, `rgt` = 7 WHERE (`categories`.`id` = 3)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 5 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 8, `rgt` = 9 WHERE (`categories`.`id` = 5)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 1, `rgt` = 10 WHERE (`categories`.`id` = 1)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 6 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 11, `rgt` = 12 WHERE (`categories`.`id` = 6)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 22 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 23 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 14, `rgt` = 15 WHERE (`categories`.`id` = 23)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 24 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 16, `rgt` = 17 WHERE (`categories`.`id` = 24)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = 13, `rgt` = 18 WHERE (`categories`.`id` = 22)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` DESC LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 13 AND `categories`.`rgt` <= 18) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 14 AND `categories`.`rgt` >= 15) AND (`categories`.id != 23)[0m
  [1m[35mSQL (1.1ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 16 AND `categories`.`rgt` >= 17) AND (`categories`.id != 24)
  [1m[36mSQL (3.9ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 3 THEN `lft` + 8 - 3 WHEN `lft` BETWEEN 4 AND 8 THEN `lft` + 2 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 3 THEN `rgt` + 8 - 3 WHEN `rgt` BETWEEN 4 AND 8 THEN `rgt` + 2 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 2 THEN 5 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.6ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'New Child', NULL, NULL, 14)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 25) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 10 AND 12 THEN `lft` + 14 - 12 WHEN `lft` BETWEEN 13 AND 14 THEN `lft` + 10 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 10 AND 12 THEN `rgt` + 14 - 12 WHEN `rgt` BETWEEN 13 AND 14 THEN `rgt` + 10 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 25 THEN 1 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 25) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft` DESC LIMIT 1
  [1m[36mSQL (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (10.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 7 THEN `lft` + 9 - 7 WHEN `lft` BETWEEN 8 AND 9 THEN `lft` + 2 - 8 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 7 THEN `rgt` + 9 - 7 WHEN `rgt` BETWEEN 8 AND 9 THEN `rgt` + 2 - 8 ELSE `rgt` END, `parent_id` = CASE WHEN id = 5 THEN 1 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.6ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 5) AND (`categories`.`lft` < 2) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 5) AND (`categories`.`lft` > 2) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.6ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 3 THEN `lft` + 9 - 3 WHEN `lft` BETWEEN 4 AND 9 THEN `lft` + 2 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 3 THEN `rgt` + 9 - 3 WHEN `rgt` BETWEEN 4 AND 9 THEN `rgt` + 2 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 2 THEN 1 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.2ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 2) AND (`categories`.`lft` > 8) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 2) AND (`categories`.`lft` < 8) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 1 AND 3 THEN `lft` + 7 - 3 WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 1 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 1 AND 3 THEN `rgt` + 7 - 3 WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 1 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN NULL ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 4)
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, NULL, NULL, NULL, 14)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (15, NULL, NULL, NULL, 16)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (17, NULL, NULL, NULL, 18)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (19, NULL, NULL, NULL, 20)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 26) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 27) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 14 AND 14 THEN `lft` + 16 - 14 WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 14 - 15 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 14 AND 14 THEN `rgt` + 16 - 14 WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 14 - 15 ELSE `rgt` END, `parent_id` = CASE WHEN id = 27 THEN 26 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 26) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 27) LIMIT 1[0m
  [1m[35mCategory Load (0.8ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 26) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 28) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 16 AND 16 THEN `lft` + 18 - 16 WHEN `lft` BETWEEN 17 AND 18 THEN `lft` + 16 - 17 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 16 AND 16 THEN `rgt` + 18 - 16 WHEN `rgt` BETWEEN 17 AND 18 THEN `rgt` + 16 - 17 ELSE `rgt` END, `parent_id` = CASE WHEN id = 28 THEN 26 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 26) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 28) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 27) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 29) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 15 AND 18 THEN `lft` + 20 - 18 WHEN `lft` BETWEEN 19 AND 20 THEN `lft` + 15 - 19 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 15 AND 18 THEN `rgt` + 20 - 18 WHEN `rgt` BETWEEN 19 AND 20 THEN `rgt` + 15 - 19 ELSE `rgt` END, `parent_id` = CASE WHEN id = 29 THEN 27 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 27) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 29) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (28.8ms)[0m  ROLLBACK
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mSELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 2)[0m
  [1m[35mSQL (0.8ms)[0m  describe `notes`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('A', 1, 2, 'Category', NULL, 2)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 2)
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('B', 3, 2, 'Category', NULL, 4)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Default') AND (`notes`.`notable_id` = 2)
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('C', 1, 2, 'Default', NULL, 2)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 2) AND (`notes`.`parent_id` IS NULL) ORDER BY `notes`.`lft`[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`notable_type` = 'Default') AND (`notes`.`notable_id` = 2) AND (`notes`.`parent_id` IS NULL) ORDER BY `notes`.`lft`
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.3ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mNote Load (0.8ms)[0m  SELECT `notable_id`, `notable_type`, `lft`, COUNT(`lft`) FROM `notes` GROUP BY `notable_id`, `notable_type`, `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mNote Load (1.0ms)[0m  [1mSELECT `notable_id`, `notable_type`, `rgt`, COUNT(`rgt`) FROM `notes` GROUP BY `notable_id`, `notable_type`, `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mSELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 3)[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('A', 1, 3, 'Category', NULL, 2)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 3)[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('B', 3, 3, 'Category', NULL, 4)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 3)[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('C', 5, 3, 'Category', NULL, 6)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 9) LIMIT 1[0m
  [1m[35mNote Load (0.9ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 10) LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mUPDATE `notes` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 2 THEN `lft` + 4 - 2 WHEN `lft` BETWEEN 3 AND 4 THEN `lft` + 2 - 3 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 2 THEN `rgt` + 4 - 2 WHEN `rgt` BETWEEN 3 AND 4 THEN `rgt` + 2 - 3 ELSE `rgt` END, `parent_id` = CASE WHEN id = 10 THEN 9 ELSE `parent_id` END WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 9) LIMIT 1[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 10) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 9) LIMIT 1
  [1m[36mNote Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 11) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `notes` SET `lft` = CASE WHEN `lft` BETWEEN 4 AND 4 THEN `lft` + 6 - 4 WHEN `lft` BETWEEN 5 AND 6 THEN `lft` + 4 - 5 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 4 AND 4 THEN `rgt` + 6 - 4 WHEN `rgt` BETWEEN 5 AND 6 THEN `rgt` + 4 - 5 ELSE `rgt` END, `parent_id` = CASE WHEN id = 11 THEN 9 ELSE `parent_id` END WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 3)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 9) LIMIT 1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 11) LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  UPDATE `notes` SET lft = null, rgt = null 
  [1m[36mNote Load (0.6ms)[0m  [1mSELECT `notes`.`id` FROM `notes` LEFT OUTER JOIN `notes` AS parent ON `notes`.`parent_id` = parent.id WHERE (`notes`.`lft` IS NULL OR `notes`.`rgt` IS NULL OR `notes`.`lft` >= `notes`.`rgt` OR (`notes`.`parent_id` IS NOT NULL AND (`notes`.`lft` <= parent.`lft` OR `notes`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`parent_id` IS NULL) ORDER BY `lft`, `rgt`, id
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`parent_id` = 1 AND `notable_id` = 1 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`parent_id` = 2 AND `notable_id` = 1 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.6ms)[0m  UPDATE `notes` SET `lft` = 2, `rgt` = 3 WHERE (`notes`.`id` = 2)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`parent_id` = 3 AND `notable_id` = 1 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `notes` SET `lft` = 4, `rgt` = 5 WHERE (`notes`.`id` = 3)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`parent_id` = 4 AND `notable_id` = 1 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `notes` SET `lft` = 6, `rgt` = 7 WHERE (`notes`.`id` = 4)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `notes` SET `lft` = 1, `rgt` = 8 WHERE (`notes`.`id` = 1)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`parent_id` = 5 AND `notable_id` = 1 AND `notable_type` = 'Departments' ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `notes` SET `lft` = 1, `rgt` = 2 WHERE (`notes`.`id` = 5)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`parent_id` = 9 AND `notable_id` = 3 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`parent_id` = 10 AND `notable_id` = 3 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `notes` SET `lft` = 2, `rgt` = 3 WHERE (`notes`.`id` = 10)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`parent_id` = 11 AND `notable_id` = 3 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `notes` SET `lft` = 4, `rgt` = 5 WHERE (`notes`.`id` = 11)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `notes` SET `lft` = 1, `rgt` = 6 WHERE (`notes`.`id` = 9)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mNote Load (0.6ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`parent_id` IS NULL) AND (`notes`.`body` = 'A') ORDER BY `lft` LIMIT 1[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`parent_id` IS NULL) AND (`notes`.`body` = 'A') ORDER BY `lft` LIMIT 1
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.`id`, `notes`.`body`, `notes`.`parent_id`, `notes`.`lft`, `notes`.`rgt`, `notes`.`notable_id`, `notes`.`notable_type` FROM `notes` WHERE (`notes`.parent_id = 9) ORDER BY `lft`[0m
  [1m[35mSQL (1.4ms)[0m  ROLLBACK
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` < 4) ORDER BY `categories`.`lft` DESC LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 3 THEN `lft` + 7 - 3 WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 2 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 3 THEN `rgt` + 7 - 3 WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 2 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN 1 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft`
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mSQL (2.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.0ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (10.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 2)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 4 AND `categories`.`rgt` >= 7) AND (`categories`.id != 3)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) AND (`categories`.id != 4)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 8 AND `categories`.`rgt` >= 9) AND (`categories`.id != 5)[0m
  [1m[35mSQL (0.5ms)[0m  UPDATE `categories` SET lft = null, rgt = null 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 1 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 2 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 2, `rgt` = 3 WHERE (`categories`.`id` = 2)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 3 ) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 4 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 5, `rgt` = 6 WHERE (`categories`.`id` = 4)[0m
  [1m[35mSQL (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 4, `rgt` = 7 WHERE (`categories`.`id` = 3)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.6ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 5 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 8, `rgt` = 9 WHERE (`categories`.`id` = 5)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 1, `rgt` = 10 WHERE (`categories`.`id` = 1)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 6 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 11, `rgt` = 12 WHERE (`categories`.`id` = 6)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 2)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 4 AND `categories`.`rgt` >= 7) AND (`categories`.id != 3)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) AND (`categories`.id != 4)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 8 AND `categories`.`rgt` >= 9) AND (`categories`.id != 5)
  [1m[36mSQL (43.2ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` > 4) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.7ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 2) AND (`categories`.`lft` > 2) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 5) AND (`categories`.`lft` > 8) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) AND (`categories`.id != 1) AND (`categories`.`lft` > 1) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) AND (`categories`.id != 6) AND (`categories`.`lft` > 11) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 3) AND (`categories`.id != 4) AND (`categories`.`lft` > 5) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` <= 8 AND `categories`.`rgt` >= 9) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mScopedCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1[0m
  [1m[35mScopedCategory Load (0.4ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft` LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `organization_id` = 0 WHERE (`categories`.`id` = 2)[0m
  [1m[35mSQL (0.6ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 1) LIMIT 1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 2) LIMIT 1[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 5) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.0ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.0ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) AND (`categories`.id != 1) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) ORDER BY `categories`.`lft`
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.3ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'New Top', NULL, NULL, 14)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 30) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 11 AND 12 THEN `lft` + 13 - 12 WHEN `lft` BETWEEN 13 AND 13 THEN `lft` + 11 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 11 AND 12 THEN `rgt` + 13 - 12 WHEN `rgt` BETWEEN 13 AND 13 THEN `rgt` + 11 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 6 THEN 30 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 30) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.6ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 3 AND 3 THEN `lft` + 7 - 3 WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 3 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 3 AND 3 THEN `rgt` + 7 - 3 WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 3 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN 2 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.2ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  DELETE FROM `categories` WHERE (`categories`.`id` = 3)
  [1m[36mCategory Load (0.7ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.5ms)[0m  [1mUPDATE `categories` SET lft = null [0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mSQL (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (1.2ms)[0m  [1mUPDATE `categories` SET rgt = null [0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mSQL (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 0 WHERE (`categories`.`id` = 6)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.6ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 2)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 4 AND `categories`.`rgt` >= 7) AND (`categories`.id != 3)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) AND (`categories`.id != 4)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 8 AND `categories`.`rgt` >= 9) AND (`categories`.id != 5)
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 11 AND `categories`.`rgt` <= 12) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 8 AND `categories`.`rgt` >= 9) AND (`categories`.id != 5)
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 11 AND `categories`.`rgt` <= 12) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.3ms)[0m  [1mSHOW TABLES[0m
  [1m[35mSQL (7.7ms)[0m  DROP TABLE `categories`
  [1m[36mSQL (2.9ms)[0m  [1mCREATE TABLE `categories` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `name` varchar(255), `parent_id` int(11), `lft` int(11), `rgt` int(11), `organization_id` int(11)) ENGINE=InnoDB[0m
  [1m[35mSQL (0.3ms)[0m  SHOW TABLES
  [1m[36mSQL (1.4ms)[0m  [1mDROP TABLE `departments`[0m
  [1m[35mSQL (2.4ms)[0m  CREATE TABLE `departments` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `name` varchar(255)) ENGINE=InnoDB
  [1m[36mSQL (0.3ms)[0m  [1mSHOW TABLES[0m
  [1m[35mSQL (1.2ms)[0m  DROP TABLE `notes`
  [1m[36mSQL (43.8ms)[0m  [1mCREATE TABLE `notes` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `body` text, `parent_id` int(11), `lft` int(11), `rgt` int(11), `notable_id` int(11), `notable_type` varchar(255)) ENGINE=InnoDB[0m
  [1m[35mSQL (0.3ms)[0m  SHOW TABLES
  [1m[36mSQL (1.2ms)[0m  [1mDROP TABLE `renamed_columns`[0m
  [1m[35mSQL (7.3ms)[0m  CREATE TABLE `renamed_columns` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `name` varchar(255), `mother_id` int(11), `red` int(11), `black` int(11)) ENGINE=InnoDB
  [1m[36mSQL (0.3ms)[0m  [1mSHOW TABLES[0m
  [1m[35mSQL (0.1ms)[0m  SELECT version FROM `schema_migrations`
Unable to load category, underlying cause No such file to load -- category 

 /home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:284:in `depend_on'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:196:in `require_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:850:in `try_to_load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:865:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:845:in `fixtures'
./test/test_helper.rb:31
./test/awesome_nested_set_test.rb:1:in `require'
./test/awesome_nested_set_test.rb:1
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
Unable to load note, underlying cause No such file to load -- note 

 /home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:284:in `depend_on'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:196:in `require_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:850:in `try_to_load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:865:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:845:in `fixtures'
./test/test_helper.rb:31
./test/awesome_nested_set_test.rb:1:in `require'
./test/awesome_nested_set_test.rb:1
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
Unable to load department, underlying cause No such file to load -- department 

 /home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:284:in `depend_on'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:196:in `require_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:850:in `try_to_load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:865:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:845:in `fixtures'
./test/test_helper.rb:31
./test/awesome_nested_set_test.rb:1:in `require'
./test/awesome_nested_set_test.rb:1
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
Unable to load category, underlying cause No such file to load -- category 

 /home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:284:in `depend_on'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:196:in `require_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:850:in `try_to_load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:865:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:845:in `fixtures'
./test/awesome_nested_set/helper_test.rb:8
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:215:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:215:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:205:in `load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:570:in `new_constants_in'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:205:in `load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:215:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.4ms)[0m  SHOW TABLES
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) AND (`categories`.id != 4) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.8ms)[0m  describe `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Child', NULL, 3, 14)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 7) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 7 AND 12 THEN `lft` + 14 - 12 WHEN `lft` BETWEEN 13 AND 14 THEN `lft` + 7 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 7 AND 12 THEN `rgt` + 14 - 12 WHEN `rgt` BETWEEN 13 AND 14 THEN `rgt` + 7 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 7 THEN 3 ELSE `parent_id` END 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 7) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  UPDATE `categories` SET `parent_id` = 5 WHERE (`categories`.`id` = 4)
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 5 AND 6 THEN `lft` + 8 - 6 WHEN `lft` BETWEEN 7 AND 8 THEN `lft` + 5 - 7 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 5 AND 6 THEN `rgt` + 8 - 6 WHEN `rgt` BETWEEN 7 AND 8 THEN `rgt` + 5 - 7 ELSE `rgt` END, `parent_id` = CASE WHEN id = 4 THEN 5 ELSE `parent_id` END [0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (9.9ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.9ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'New Root', NULL, NULL, 14)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `parent_id` = NULL WHERE (`categories`.`id` = 4)
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 1 AND 4 THEN `lft` + 6 - 4 WHEN `lft` BETWEEN 5 AND 6 THEN `lft` + 1 - 5 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 1 AND 4 THEN `rgt` + 6 - 4 WHEN `rgt` BETWEEN 5 AND 6 THEN `rgt` + 1 - 5 ELSE `rgt` END, `parent_id` = CASE WHEN id = 4 THEN NULL ELSE `parent_id` END 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Child', NULL, 3, 14)
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 9) LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 7 AND 12 THEN `lft` + 14 - 12 WHEN `lft` BETWEEN 13 AND 14 THEN `lft` + 7 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 7 AND 12 THEN `rgt` + 14 - 12 WHEN `rgt` BETWEEN 13 AND 14 THEN `rgt` + 7 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 9 THEN 3 ELSE `parent_id` END [0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 9) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.6ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `parent_id` = 5 WHERE (`categories`.`id` = 4)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 5 AND 6 THEN `lft` + 8 - 6 WHEN `lft` BETWEEN 7 AND 8 THEN `lft` + 5 - 7 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 5 AND 6 THEN `rgt` + 8 - 6 WHEN `rgt` BETWEEN 7 AND 8 THEN `rgt` + 5 - 7 ELSE `rgt` END, `parent_id` = CASE WHEN id = 4 THEN 5 ELSE `parent_id` END 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 1 AND 3 THEN `lft` + 7 - 3 WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 1 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 1 AND 3 THEN `rgt` + 7 - 3 WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 1 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN NULL ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `parent_id` = 3 WHERE (`categories`.`id` = 5)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 7 AND 7 THEN `lft` + 9 - 7 WHEN `lft` BETWEEN 8 AND 9 THEN `lft` + 7 - 8 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 7 AND 7 THEN `rgt` + 9 - 7 WHEN `rgt` BETWEEN 8 AND 9 THEN `rgt` + 7 - 8 ELSE `rgt` END, `parent_id` = CASE WHEN id = 5 THEN 3 ELSE `parent_id` END 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.6ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
WARNING: Can't mass-assign protected attributes: lft, rgt
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Child', NULL, 3, 14)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 10) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 7 AND 12 THEN `lft` + 14 - 12 WHEN `lft` BETWEEN 13 AND 14 THEN `lft` + 7 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 7 AND 12 THEN `rgt` + 14 - 12 WHEN `rgt` BETWEEN 13 AND 14 THEN `rgt` + 7 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 10 THEN 3 ELSE `parent_id` END 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 10) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (28.0ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`renamed_columns`.`black`) AS max_id FROM `renamed_columns`
  [1m[36mSQL (1.1ms)[0m  [1mdescribe `renamed_columns`[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `renamed_columns` (`black`, `mother_id`, `name`, `red`) VALUES (2, NULL, NULL, 1)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  DELETE FROM `categories` WHERE (`categories`.`lft` > 4 AND `categories`.`rgt` < 7)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = (`lft` - 4) WHERE (`lft` > 7)[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `rgt` = (`rgt` - 4) WHERE (`rgt` > 7)
  [1m[36mSQL (0.2ms)[0m  [1mDELETE FROM `categories` WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'lawyers', NULL, NULL, 14)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (15, 'United States', NULL, NULL, 16)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 11) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 12) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 14 AND 14 THEN `lft` + 16 - 14 WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 14 - 15 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 14 AND 14 THEN `rgt` + 16 - 14 WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 14 - 15 ELSE `rgt` END, `parent_id` = CASE WHEN id = 12 THEN 11 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 11) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 12) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (17, 'Patent Law', NULL, NULL, 18)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 12) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 13) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 18 - 16 WHEN `lft` BETWEEN 17 AND 18 THEN `lft` + 15 - 17 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 18 - 16 WHEN `rgt` BETWEEN 17 AND 18 THEN `rgt` + 15 - 17 ELSE `rgt` END, `parent_id` = CASE WHEN id = 13 THEN 12 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 12) LIMIT 1[0m
  [1m[35mCategory Load (0.2ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 13) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 11) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.parent_id = 11)
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.parent_id = 12)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` >= 13 AND `categories`.`rgt` <= 18) AND (`categories`.id != 11)
  [1m[36mSQL (5.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 4 AND `categories`.`rgt` <= 7) AND (`categories`.id != 3) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.3ms)[0m  DELETE FROM `categories` WHERE (`categories`.`id` = 4)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = (`lft` - 4) WHERE (`lft` > 7)[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `rgt` = (`rgt` - 4) WHERE (`rgt` > 7)
  [1m[36mSQL (0.2ms)[0m  [1mDELETE FROM `categories` WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.7ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 4 AND `categories`.`rgt` <= 7) AND (`categories`.id != 3) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.3ms)[0m  DELETE FROM `categories` WHERE (`categories`.`id` = 4)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = (`lft` - 4) WHERE (`lft` > 7)[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `rgt` = (`rgt` - 4) WHERE (`rgt` > 7)
  [1m[36mSQL (0.2ms)[0m  [1mDELETE FROM `categories` WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'New Top', NULL, NULL, 14)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 14) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mSQL (10.0ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 1 AND 10 THEN `lft` + 13 - 10 WHEN `lft` BETWEEN 11 AND 13 THEN `lft` + 1 - 11 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 1 AND 10 THEN `rgt` + 13 - 10 WHEN `rgt` BETWEEN 11 AND 13 THEN `rgt` + 1 - 11 ELSE `rgt` END, `parent_id` = CASE WHEN id = 1 THEN 14 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 14) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (20.7ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) ORDER BY `categories`.`lft`
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`name` = 'Child 1') LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Child 1.1', NULL, NULL, 14)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (15, 'Child 1.1.1', NULL, NULL, 16)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (17, 'Child 1.1.1.1', NULL, NULL, 18)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (19, 'Child 1.2', NULL, NULL, 20)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 15) LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 3 AND 12 THEN `lft` + 14 - 12 WHEN `lft` BETWEEN 13 AND 14 THEN `lft` + 3 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 3 AND 12 THEN `rgt` + 14 - 12 WHEN `rgt` BETWEEN 13 AND 14 THEN `rgt` + 3 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 15 THEN 2 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 15) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 15) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 16) LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 4 AND 14 THEN `lft` + 16 - 14 WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 4 - 15 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 4 AND 14 THEN `rgt` + 16 - 14 WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 4 - 15 ELSE `rgt` END, `parent_id` = CASE WHEN id = 16 THEN 15 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 15) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 16) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 16) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 17) LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 5 AND 16 THEN `lft` + 18 - 16 WHEN `lft` BETWEEN 17 AND 18 THEN `lft` + 5 - 17 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 5 AND 16 THEN `rgt` + 18 - 16 WHEN `rgt` BETWEEN 17 AND 18 THEN `rgt` + 5 - 17 ELSE `rgt` END, `parent_id` = CASE WHEN id = 17 THEN 16 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.6ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 16) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 17) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 18) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 9 AND 18 THEN `lft` + 20 - 18 WHEN `lft` BETWEEN 19 AND 20 THEN `lft` + 9 - 19 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 9 AND 18 THEN `rgt` + 20 - 18 WHEN `rgt` BETWEEN 19 AND 20 THEN `rgt` + 9 - 19 ELSE `rgt` END, `parent_id` = CASE WHEN id = 18 THEN 2 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 18) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 18) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (1.2ms)[0m  ROLLBACK
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 1) LIMIT 1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mNote Load (0.1ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 1) LIMIT 1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 2) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.parent_id = 4)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.parent_id = 3)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.parent_id = 1)[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mScopedCategory Load (0.6ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1
  [1m[36mScopedCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft` LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `organization_id` = 0 WHERE (`categories`.`id` = 2)
  [1m[36mSQL (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mScopedCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1[0m
  [1m[35mScopedCategory Load (0.7ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft` LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `organization_id` = 0 WHERE (`categories`.`id` = 2)[0m
  [1m[35mSQL (0.6ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (rgt - lft = 1)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`rgt` - `lft` = 1) ORDER BY `lft`
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`rgt` - `lft` = 1)[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`rgt` - `lft` = 1) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`rgt` - `lft` = 1) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`rgt` - `lft` = 1) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`rgt` - `lft` = 1) ORDER BY `lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = NULL WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mSQL (0.6ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `rgt` = NULL WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 12 WHERE (`categories`.`id` = 6)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 1 WHERE (`categories`.`id` = 3)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `rgt` = 10 WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` < 4) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 5) AND (`categories`.`lft` < 8) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 2) AND (`categories`.`lft` < 2) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) AND (`categories`.id != 1) AND (`categories`.`lft` < 1) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 3) AND (`categories`.id != 4) AND (`categories`.`lft` < 5) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 2)[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) AND (`categories`.id != 4)[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` < 4) ORDER BY `categories`.`lft` DESC LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 3 THEN `lft` + 7 - 3 WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 2 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 3 THEN `rgt` + 7 - 3 WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 2 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN 1 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` < 2) ORDER BY `categories`.`lft` DESC LIMIT 1[0m
  [1m[35mCategory Load (10.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` > 2) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (7.9ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) AND (`categories`.id != 1) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (9.9ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` > 4) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 9 - 7 WHEN `lft` BETWEEN 8 AND 9 THEN `lft` + 4 - 8 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 9 - 7 WHEN `rgt` BETWEEN 8 AND 9 THEN `rgt` + 4 - 8 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN 1 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` > 6) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` < 6) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.3ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Node-1', NULL, NULL, 14)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (15, 'Node-2', NULL, NULL, 16)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (17, 'Node-3', NULL, NULL, 18)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 19) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 20) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 14 AND 14 THEN `lft` + 16 - 14 WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 14 - 15 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 14 AND 14 THEN `rgt` + 16 - 14 WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 14 - 15 ELSE `rgt` END, `parent_id` = CASE WHEN id = 20 THEN 19 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 19) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 20) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 19) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 21) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 16 AND 16 THEN `lft` + 18 - 16 WHEN `lft` BETWEEN 17 AND 18 THEN `lft` + 16 - 17 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 16 AND 16 THEN `rgt` + 18 - 16 WHEN `rgt` BETWEEN 17 AND 18 THEN `rgt` + 16 - 17 ELSE `rgt` END, `parent_id` = CASE WHEN id = 21 THEN 19 ELSE `parent_id` END [0m
  [1m[35mSQL (0.3ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 19) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 21) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` DESC LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 13 AND `categories`.`rgt` <= 18) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 14 AND `categories`.`rgt` >= 15) AND (`categories`.id != 20)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 16 AND `categories`.`rgt` >= 17) AND (`categories`.id != 21)
  [1m[36mSQL (0.6ms)[0m  [1mUPDATE `categories` SET lft = null, rgt = null [0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 1 ) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 2 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 2, `rgt` = 3 WHERE (`categories`.`id` = 2)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 3 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 4 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 5, `rgt` = 6 WHERE (`categories`.`id` = 4)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 4, `rgt` = 7 WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 5 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 8, `rgt` = 9 WHERE (`categories`.`id` = 5)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 1, `rgt` = 10 WHERE (`categories`.`id` = 1)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 6 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 11, `rgt` = 12 WHERE (`categories`.`id` = 6)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 19 ) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 20 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 14, `rgt` = 15 WHERE (`categories`.`id` = 20)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 21 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 16, `rgt` = 17 WHERE (`categories`.`id` = 21)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 13, `rgt` = 18 WHERE (`categories`.`id` = 19)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` DESC LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 13 AND `categories`.`rgt` <= 18) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 14 AND `categories`.`rgt` >= 15) AND (`categories`.id != 20)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 16 AND `categories`.`rgt` >= 17) AND (`categories`.id != 21)[0m
  [1m[35mSQL (46.3ms)[0m  ROLLBACK
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Root1', NULL, NULL, 14)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (15, 'Root2', NULL, NULL, 16)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (17, 'Root3', NULL, NULL, 18)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 22) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 23) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 14 AND 14 THEN `lft` + 16 - 14 WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 14 - 15 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 14 AND 14 THEN `rgt` + 16 - 14 WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 14 - 15 ELSE `rgt` END, `parent_id` = CASE WHEN id = 23 THEN 22 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 22) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 23) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 22) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 24) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 16 AND 16 THEN `lft` + 18 - 16 WHEN `lft` BETWEEN 17 AND 18 THEN `lft` + 16 - 17 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 16 AND 16 THEN `rgt` + 18 - 16 WHEN `rgt` BETWEEN 17 AND 18 THEN `rgt` + 16 - 17 ELSE `rgt` END, `parent_id` = CASE WHEN id = 24 THEN 22 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 22) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 24) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` DESC LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 13 AND `categories`.`rgt` <= 18) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 14 AND `categories`.`rgt` >= 15) AND (`categories`.id != 23)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 16 AND `categories`.`rgt` >= 17) AND (`categories`.id != 24)[0m
  [1m[35mSQL (0.5ms)[0m  UPDATE `categories` SET lft = null, rgt = null 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 1 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 2 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 2, `rgt` = 3 WHERE (`categories`.`id` = 2)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 3 ) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 4 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 5, `rgt` = 6 WHERE (`categories`.`id` = 4)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 4, `rgt` = 7 WHERE (`categories`.`id` = 3)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 5 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 8, `rgt` = 9 WHERE (`categories`.`id` = 5)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 1, `rgt` = 10 WHERE (`categories`.`id` = 1)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 6 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 11, `rgt` = 12 WHERE (`categories`.`id` = 6)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 22 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 23 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 14, `rgt` = 15 WHERE (`categories`.`id` = 23)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 24 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 16, `rgt` = 17 WHERE (`categories`.`id` = 24)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 13, `rgt` = 18 WHERE (`categories`.`id` = 22)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` DESC LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 13 AND `categories`.`rgt` <= 18) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.6ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 14 AND `categories`.`rgt` >= 15) AND (`categories`.id != 23)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 16 AND `categories`.`rgt` >= 17) AND (`categories`.id != 24)
  [1m[36mSQL (3.2ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 3 THEN `lft` + 8 - 3 WHEN `lft` BETWEEN 4 AND 8 THEN `lft` + 2 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 3 THEN `rgt` + 8 - 3 WHEN `rgt` BETWEEN 4 AND 8 THEN `rgt` + 2 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 2 THEN 5 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.9ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'New Child', NULL, NULL, 14)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 25) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 10 AND 12 THEN `lft` + 14 - 12 WHEN `lft` BETWEEN 13 AND 14 THEN `lft` + 10 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 10 AND 12 THEN `rgt` + 14 - 12 WHEN `rgt` BETWEEN 13 AND 14 THEN `rgt` + 10 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 25 THEN 1 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 25) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft` DESC LIMIT 1
  [1m[36mSQL (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 7 THEN `lft` + 9 - 7 WHEN `lft` BETWEEN 8 AND 9 THEN `lft` + 2 - 8 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 7 THEN `rgt` + 9 - 7 WHEN `rgt` BETWEEN 8 AND 9 THEN `rgt` + 2 - 8 ELSE `rgt` END, `parent_id` = CASE WHEN id = 5 THEN 1 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 5) AND (`categories`.`lft` < 2) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 5) AND (`categories`.`lft` > 2) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.6ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 3 THEN `lft` + 9 - 3 WHEN `lft` BETWEEN 4 AND 9 THEN `lft` + 2 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 3 THEN `rgt` + 9 - 3 WHEN `rgt` BETWEEN 4 AND 9 THEN `rgt` + 2 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 2 THEN 1 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 2) AND (`categories`.`lft` > 8) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 2) AND (`categories`.`lft` < 8) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 1 AND 3 THEN `lft` + 7 - 3 WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 1 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 1 AND 3 THEN `rgt` + 7 - 3 WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 1 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN NULL ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 4)
  [1m[36mCategory Load (0.7ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, NULL, NULL, NULL, 14)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (15, NULL, NULL, NULL, 16)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (17, NULL, NULL, NULL, 18)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (19, NULL, NULL, NULL, 20)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 26) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 27) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 14 AND 14 THEN `lft` + 16 - 14 WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 14 - 15 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 14 AND 14 THEN `rgt` + 16 - 14 WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 14 - 15 ELSE `rgt` END, `parent_id` = CASE WHEN id = 27 THEN 26 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 26) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 27) LIMIT 1[0m
  [1m[35mCategory Load (0.8ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 26) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 28) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 16 AND 16 THEN `lft` + 18 - 16 WHEN `lft` BETWEEN 17 AND 18 THEN `lft` + 16 - 17 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 16 AND 16 THEN `rgt` + 18 - 16 WHEN `rgt` BETWEEN 17 AND 18 THEN `rgt` + 16 - 17 ELSE `rgt` END, `parent_id` = CASE WHEN id = 28 THEN 26 ELSE `parent_id` END [0m
  [1m[35mSQL (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 26) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 28) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 27) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 29) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 15 AND 18 THEN `lft` + 20 - 18 WHEN `lft` BETWEEN 19 AND 20 THEN `lft` + 15 - 19 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 15 AND 18 THEN `rgt` + 20 - 18 WHEN `rgt` BETWEEN 19 AND 20 THEN `rgt` + 15 - 19 ELSE `rgt` END, `parent_id` = CASE WHEN id = 29 THEN 27 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 27) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 29) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (35.7ms)[0m  ROLLBACK
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mSELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 2)[0m
  [1m[35mSQL (0.9ms)[0m  describe `notes`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('A', 1, 2, 'Category', NULL, 2)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 2)
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('B', 3, 2, 'Category', NULL, 4)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Default') AND (`notes`.`notable_id` = 2)
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('C', 1, 2, 'Default', NULL, 2)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 2) AND (`notes`.`parent_id` IS NULL) ORDER BY `notes`.`lft`[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`notable_type` = 'Default') AND (`notes`.`notable_id` = 2) AND (`notes`.`parent_id` IS NULL) ORDER BY `notes`.`lft`
  [1m[36mSQL (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mNote Load (0.8ms)[0m  SELECT `notable_id`, `notable_type`, `lft`, COUNT(`lft`) FROM `notes` GROUP BY `notable_id`, `notable_type`, `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mNote Load (0.7ms)[0m  [1mSELECT `notable_id`, `notable_type`, `rgt`, COUNT(`rgt`) FROM `notes` GROUP BY `notable_id`, `notable_type`, `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mSELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 3)[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('A', 1, 3, 'Category', NULL, 2)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 3)[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('B', 3, 3, 'Category', NULL, 4)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 3)[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('C', 5, 3, 'Category', NULL, 6)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 9) LIMIT 1[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 10) LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mUPDATE `notes` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 2 THEN `lft` + 4 - 2 WHEN `lft` BETWEEN 3 AND 4 THEN `lft` + 2 - 3 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 2 THEN `rgt` + 4 - 2 WHEN `rgt` BETWEEN 3 AND 4 THEN `rgt` + 2 - 3 ELSE `rgt` END, `parent_id` = CASE WHEN id = 10 THEN 9 ELSE `parent_id` END WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 9) LIMIT 1[0m
  [1m[35mNote Load (0.2ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 10) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 9) LIMIT 1
  [1m[36mNote Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 11) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `notes` SET `lft` = CASE WHEN `lft` BETWEEN 4 AND 4 THEN `lft` + 6 - 4 WHEN `lft` BETWEEN 5 AND 6 THEN `lft` + 4 - 5 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 4 AND 4 THEN `rgt` + 6 - 4 WHEN `rgt` BETWEEN 5 AND 6 THEN `rgt` + 4 - 5 ELSE `rgt` END, `parent_id` = CASE WHEN id = 11 THEN 9 ELSE `parent_id` END WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 3)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 9) LIMIT 1
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 11) LIMIT 1[0m
  [1m[35mSQL (0.6ms)[0m  UPDATE `notes` SET lft = null, rgt = null 
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.`id` FROM `notes` LEFT OUTER JOIN `notes` AS parent ON `notes`.`parent_id` = parent.id WHERE (`notes`.`lft` IS NULL OR `notes`.`rgt` IS NULL OR `notes`.`lft` >= `notes`.`rgt` OR (`notes`.`parent_id` IS NOT NULL AND (`notes`.`lft` <= parent.`lft` OR `notes`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mNote Load (0.6ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`parent_id` IS NULL) ORDER BY `lft`, `rgt`, id
  [1m[36mNote Load (0.6ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`parent_id` = 1 AND `notable_id` = 1 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`parent_id` = 2 AND `notable_id` = 1 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `notes` SET `lft` = 2, `rgt` = 3 WHERE (`notes`.`id` = 2)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`parent_id` = 3 AND `notable_id` = 1 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `notes` SET `lft` = 4, `rgt` = 5 WHERE (`notes`.`id` = 3)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`parent_id` = 4 AND `notable_id` = 1 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.6ms)[0m  UPDATE `notes` SET `lft` = 6, `rgt` = 7 WHERE (`notes`.`id` = 4)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `notes` SET `lft` = 1, `rgt` = 8 WHERE (`notes`.`id` = 1)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`parent_id` = 5 AND `notable_id` = 1 AND `notable_type` = 'Departments' ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `notes` SET `lft` = 1, `rgt` = 2 WHERE (`notes`.`id` = 5)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`parent_id` = 9 AND `notable_id` = 3 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`parent_id` = 10 AND `notable_id` = 3 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `notes` SET `lft` = 2, `rgt` = 3 WHERE (`notes`.`id` = 10)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`parent_id` = 11 AND `notable_id` = 3 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `notes` SET `lft` = 4, `rgt` = 5 WHERE (`notes`.`id` = 11)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `notes` SET `lft` = 1, `rgt` = 6 WHERE (`notes`.`id` = 9)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`parent_id` IS NULL) AND (`notes`.`body` = 'A') ORDER BY `lft` LIMIT 1[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`parent_id` IS NULL) AND (`notes`.`body` = 'A') ORDER BY `lft` LIMIT 1
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.`id`, `notes`.`body`, `notes`.`parent_id`, `notes`.`lft`, `notes`.`rgt`, `notes`.`notable_id`, `notes`.`notable_type` FROM `notes` WHERE (`notes`.parent_id = 9) ORDER BY `lft`[0m
  [1m[35mSQL (1.3ms)[0m  ROLLBACK
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` < 4) ORDER BY `categories`.`lft` DESC LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 3 THEN `lft` + 7 - 3 WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 2 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 3 THEN `rgt` + 7 - 3 WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 2 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN 1 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft`
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.0ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.6ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 2)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 4 AND `categories`.`rgt` >= 7) AND (`categories`.id != 3)[0m
  [1m[35mSQL (0.6ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) AND (`categories`.id != 4)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 8 AND `categories`.`rgt` >= 9) AND (`categories`.id != 5)[0m
  [1m[35mSQL (0.5ms)[0m  UPDATE `categories` SET lft = null, rgt = null 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 1 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 2 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 2, `rgt` = 3 WHERE (`categories`.`id` = 2)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 3 ) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 4 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 5, `rgt` = 6 WHERE (`categories`.`id` = 4)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 4, `rgt` = 7 WHERE (`categories`.`id` = 3)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.6ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 5 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 8, `rgt` = 9 WHERE (`categories`.`id` = 5)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 1, `rgt` = 10 WHERE (`categories`.`id` = 1)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 6 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 11, `rgt` = 12 WHERE (`categories`.`id` = 6)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 2)[0m
  [1m[35mSQL (0.6ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 4 AND `categories`.`rgt` >= 7) AND (`categories`.id != 3)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) AND (`categories`.id != 4)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 8 AND `categories`.`rgt` >= 9) AND (`categories`.id != 5)
  [1m[36mSQL (45.8ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` > 4) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 2) AND (`categories`.`lft` > 2) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 5) AND (`categories`.`lft` > 8) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) AND (`categories`.id != 1) AND (`categories`.`lft` > 1) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) AND (`categories`.id != 6) AND (`categories`.`lft` > 11) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 3) AND (`categories`.id != 4) AND (`categories`.`lft` > 5) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` <= 8 AND `categories`.`rgt` >= 9) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mScopedCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1[0m
  [1m[35mScopedCategory Load (0.4ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft` LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `organization_id` = 0 WHERE (`categories`.`id` = 2)[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 1) LIMIT 1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 2) LIMIT 1[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 5) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.0ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.0ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) AND (`categories`.id != 1) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) ORDER BY `categories`.`lft`
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (1.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'New Top', NULL, NULL, 14)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 30) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mSQL (0.9ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 11 AND 12 THEN `lft` + 13 - 12 WHEN `lft` BETWEEN 13 AND 13 THEN `lft` + 11 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 11 AND 12 THEN `rgt` + 13 - 12 WHEN `rgt` BETWEEN 13 AND 13 THEN `rgt` + 11 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 6 THEN 30 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 30) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.8ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 3 AND 3 THEN `lft` + 7 - 3 WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 3 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 3 AND 3 THEN `rgt` + 7 - 3 WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 3 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN 2 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  DELETE FROM `categories` WHERE (`categories`.`id` = 3)
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (2.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.5ms)[0m  [1mUPDATE `categories` SET lft = null [0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mSQL (1.0ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.6ms)[0m  [1mUPDATE `categories` SET rgt = null [0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mSQL (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 0 WHERE (`categories`.`id` = 6)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (15.9ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 2)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 4 AND `categories`.`rgt` >= 7) AND (`categories`.id != 3)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) AND (`categories`.id != 4)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 8 AND `categories`.`rgt` >= 9) AND (`categories`.id != 5)
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 11 AND `categories`.`rgt` <= 12) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 2)[0m
  [1m[35mSQL (0.7ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 8 AND `categories`.`rgt` >= 9) AND (`categories`.id != 5)
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 11 AND `categories`.`rgt` <= 12) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.3ms)[0m  [1mSHOW TABLES[0m
  [1m[35mSQL (14.0ms)[0m  DROP TABLE `categories`
  [1m[36mSQL (9.7ms)[0m  [1mCREATE TABLE `categories` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `name` varchar(255), `parent_id` int(11), `lft` int(11), `rgt` int(11), `organization_id` int(11)) ENGINE=InnoDB[0m
  [1m[35mSQL (0.3ms)[0m  SHOW TABLES
  [1m[36mSQL (1.5ms)[0m  [1mDROP TABLE `departments`[0m
  [1m[35mSQL (8.3ms)[0m  CREATE TABLE `departments` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `name` varchar(255)) ENGINE=InnoDB
  [1m[36mSQL (0.3ms)[0m  [1mSHOW TABLES[0m
  [1m[35mSQL (1.3ms)[0m  DROP TABLE `notes`
  [1m[36mSQL (3.4ms)[0m  [1mCREATE TABLE `notes` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `body` text, `parent_id` int(11), `lft` int(11), `rgt` int(11), `notable_id` int(11), `notable_type` varchar(255)) ENGINE=InnoDB[0m
  [1m[35mSQL (0.3ms)[0m  SHOW TABLES
  [1m[36mSQL (1.2ms)[0m  [1mDROP TABLE `renamed_columns`[0m
  [1m[35mSQL (3.1ms)[0m  CREATE TABLE `renamed_columns` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `name` varchar(255), `mother_id` int(11), `red` int(11), `black` int(11)) ENGINE=InnoDB
  [1m[36mSQL (0.3ms)[0m  [1mSHOW TABLES[0m
  [1m[35mSQL (0.2ms)[0m  SELECT version FROM `schema_migrations`
Unable to load category, underlying cause No such file to load -- category 

 /home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:284:in `depend_on'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:196:in `require_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:850:in `try_to_load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:865:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:845:in `fixtures'
./test/test_helper.rb:31
./test/awesome_nested_set_test.rb:1:in `require'
./test/awesome_nested_set_test.rb:1
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
Unable to load note, underlying cause No such file to load -- note 

 /home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:284:in `depend_on'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:196:in `require_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:850:in `try_to_load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:865:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:845:in `fixtures'
./test/test_helper.rb:31
./test/awesome_nested_set_test.rb:1:in `require'
./test/awesome_nested_set_test.rb:1
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
Unable to load department, underlying cause No such file to load -- department 

 /home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:284:in `depend_on'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:196:in `require_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:850:in `try_to_load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:865:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:845:in `fixtures'
./test/test_helper.rb:31
./test/awesome_nested_set_test.rb:1:in `require'
./test/awesome_nested_set_test.rb:1
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
Unable to load category, underlying cause No such file to load -- category 

 /home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:284:in `depend_on'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:196:in `require_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:850:in `try_to_load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:865:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:845:in `fixtures'
./test/awesome_nested_set/helper_test.rb:8
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:215:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:215:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:205:in `load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:570:in `new_constants_in'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:205:in `load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:215:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.3ms)[0m  SHOW TABLES
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) AND (`categories`.id != 4) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.6ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.8ms)[0m  describe `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Child', NULL, 3, 14)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 7) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 7 AND 12 THEN `lft` + 14 - 12 WHEN `lft` BETWEEN 13 AND 14 THEN `lft` + 7 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 7 AND 12 THEN `rgt` + 14 - 12 WHEN `rgt` BETWEEN 13 AND 14 THEN `rgt` + 7 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 7 THEN 3 ELSE `parent_id` END 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 7) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `parent_id` = 5 WHERE (`categories`.`id` = 4)
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 5 AND 6 THEN `lft` + 8 - 6 WHEN `lft` BETWEEN 7 AND 8 THEN `lft` + 5 - 7 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 5 AND 6 THEN `rgt` + 8 - 6 WHEN `rgt` BETWEEN 7 AND 8 THEN `rgt` + 5 - 7 ELSE `rgt` END, `parent_id` = CASE WHEN id = 4 THEN 5 ELSE `parent_id` END [0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.9ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'New Root', NULL, NULL, 14)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.6ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `parent_id` = NULL WHERE (`categories`.`id` = 4)
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 1 AND 4 THEN `lft` + 6 - 4 WHEN `lft` BETWEEN 5 AND 6 THEN `lft` + 1 - 5 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 1 AND 4 THEN `rgt` + 6 - 4 WHEN `rgt` BETWEEN 5 AND 6 THEN `rgt` + 1 - 5 ELSE `rgt` END, `parent_id` = CASE WHEN id = 4 THEN NULL ELSE `parent_id` END 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Child', NULL, 3, 14)
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 9) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 7 AND 12 THEN `lft` + 14 - 12 WHEN `lft` BETWEEN 13 AND 14 THEN `lft` + 7 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 7 AND 12 THEN `rgt` + 14 - 12 WHEN `rgt` BETWEEN 13 AND 14 THEN `rgt` + 7 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 9 THEN 3 ELSE `parent_id` END [0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 9) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.9ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `parent_id` = 5 WHERE (`categories`.`id` = 4)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 5 AND 6 THEN `lft` + 8 - 6 WHEN `lft` BETWEEN 7 AND 8 THEN `lft` + 5 - 7 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 5 AND 6 THEN `rgt` + 8 - 6 WHEN `rgt` BETWEEN 7 AND 8 THEN `rgt` + 5 - 7 ELSE `rgt` END, `parent_id` = CASE WHEN id = 4 THEN 5 ELSE `parent_id` END 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 1 AND 3 THEN `lft` + 7 - 3 WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 1 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 1 AND 3 THEN `rgt` + 7 - 3 WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 1 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN NULL ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `parent_id` = 3 WHERE (`categories`.`id` = 5)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 7 AND 7 THEN `lft` + 9 - 7 WHEN `lft` BETWEEN 8 AND 9 THEN `lft` + 7 - 8 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 7 AND 7 THEN `rgt` + 9 - 7 WHEN `rgt` BETWEEN 8 AND 9 THEN `rgt` + 7 - 8 ELSE `rgt` END, `parent_id` = CASE WHEN id = 5 THEN 3 ELSE `parent_id` END 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.6ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
WARNING: Can't mass-assign protected attributes: lft, rgt
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Child', NULL, 3, 14)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 10) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 7 AND 12 THEN `lft` + 14 - 12 WHEN `lft` BETWEEN 13 AND 14 THEN `lft` + 7 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 7 AND 12 THEN `rgt` + 14 - 12 WHEN `rgt` BETWEEN 13 AND 14 THEN `rgt` + 7 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 10 THEN 3 ELSE `parent_id` END 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 10) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`renamed_columns`.`black`) AS max_id FROM `renamed_columns`
  [1m[36mSQL (0.7ms)[0m  [1mdescribe `renamed_columns`[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `renamed_columns` (`black`, `mother_id`, `name`, `red`) VALUES (2, NULL, NULL, 1)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  DELETE FROM `categories` WHERE (`categories`.`lft` > 4 AND `categories`.`rgt` < 7)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = (`lft` - 4) WHERE (`lft` > 7)[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `rgt` = (`rgt` - 4) WHERE (`rgt` > 7)
  [1m[36mSQL (0.2ms)[0m  [1mDELETE FROM `categories` WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'lawyers', NULL, NULL, 14)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (15, 'United States', NULL, NULL, 16)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 11) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 12) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 14 AND 14 THEN `lft` + 16 - 14 WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 14 - 15 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 14 AND 14 THEN `rgt` + 16 - 14 WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 14 - 15 ELSE `rgt` END, `parent_id` = CASE WHEN id = 12 THEN 11 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 11) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 12) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (17, 'Patent Law', NULL, NULL, 18)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 12) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 13) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 18 - 16 WHEN `lft` BETWEEN 17 AND 18 THEN `lft` + 15 - 17 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 18 - 16 WHEN `rgt` BETWEEN 17 AND 18 THEN `rgt` + 15 - 17 ELSE `rgt` END, `parent_id` = CASE WHEN id = 13 THEN 12 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 12) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 13) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 11) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.parent_id = 11)
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.parent_id = 12)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` >= 13 AND `categories`.`rgt` <= 18) AND (`categories`.id != 11)
  [1m[36mSQL (2.9ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 4 AND `categories`.`rgt` <= 7) AND (`categories`.id != 3) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.3ms)[0m  DELETE FROM `categories` WHERE (`categories`.`id` = 4)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = (`lft` - 4) WHERE (`lft` > 7)[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `rgt` = (`rgt` - 4) WHERE (`rgt` > 7)
  [1m[36mSQL (0.2ms)[0m  [1mDELETE FROM `categories` WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 4 AND `categories`.`rgt` <= 7) AND (`categories`.id != 3) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.3ms)[0m  DELETE FROM `categories` WHERE (`categories`.`id` = 4)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = (`lft` - 4) WHERE (`lft` > 7)[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `rgt` = (`rgt` - 4) WHERE (`rgt` > 7)
  [1m[36mSQL (0.2ms)[0m  [1mDELETE FROM `categories` WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.6ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'New Top', NULL, NULL, 14)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 14) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 1 AND 10 THEN `lft` + 13 - 10 WHEN `lft` BETWEEN 11 AND 13 THEN `lft` + 1 - 11 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 1 AND 10 THEN `rgt` + 13 - 10 WHEN `rgt` BETWEEN 11 AND 13 THEN `rgt` + 1 - 11 ELSE `rgt` END, `parent_id` = CASE WHEN id = 1 THEN 14 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 14) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) ORDER BY `categories`.`lft`
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`name` = 'Child 1') LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.5ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Child 1.1', NULL, NULL, 14)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (15, 'Child 1.1.1', NULL, NULL, 16)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (17, 'Child 1.1.1.1', NULL, NULL, 18)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (19, 'Child 1.2', NULL, NULL, 20)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.2ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 15) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 3 AND 12 THEN `lft` + 14 - 12 WHEN `lft` BETWEEN 13 AND 14 THEN `lft` + 3 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 3 AND 12 THEN `rgt` + 14 - 12 WHEN `rgt` BETWEEN 13 AND 14 THEN `rgt` + 3 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 15 THEN 2 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 15) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 15) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 16) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 4 AND 14 THEN `lft` + 16 - 14 WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 4 - 15 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 4 AND 14 THEN `rgt` + 16 - 14 WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 4 - 15 ELSE `rgt` END, `parent_id` = CASE WHEN id = 16 THEN 15 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 15) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 16) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 16) LIMIT 1[0m
  [1m[35mCategory Load (0.2ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 17) LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 5 AND 16 THEN `lft` + 18 - 16 WHEN `lft` BETWEEN 17 AND 18 THEN `lft` + 5 - 17 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 5 AND 16 THEN `rgt` + 18 - 16 WHEN `rgt` BETWEEN 17 AND 18 THEN `rgt` + 5 - 17 ELSE `rgt` END, `parent_id` = CASE WHEN id = 17 THEN 16 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 16) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 17) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 18) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 9 AND 18 THEN `lft` + 20 - 18 WHEN `lft` BETWEEN 19 AND 20 THEN `lft` + 9 - 19 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 9 AND 18 THEN `rgt` + 20 - 18 WHEN `rgt` BETWEEN 19 AND 20 THEN `rgt` + 9 - 19 ELSE `rgt` END, `parent_id` = CASE WHEN id = 18 THEN 2 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 18) LIMIT 1[0m
  [1m[35mCategory Load (0.9ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 18) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (1.3ms)[0m  ROLLBACK
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 1) LIMIT 1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mNote Load (0.1ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 1) LIMIT 1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 2) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.parent_id = 4)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.parent_id = 3)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.parent_id = 1)[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mScopedCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1
  [1m[36mScopedCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft` LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `organization_id` = 0 WHERE (`categories`.`id` = 2)
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mScopedCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1[0m
  [1m[35mScopedCategory Load (0.4ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft` LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `organization_id` = 0 WHERE (`categories`.`id` = 2)[0m
  [1m[35mSQL (0.9ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (rgt - lft = 1)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`rgt` - `lft` = 1) ORDER BY `lft`
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`rgt` - `lft` = 1)[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`rgt` - `lft` = 1) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`rgt` - `lft` = 1) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`rgt` - `lft` = 1) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`rgt` - `lft` = 1) ORDER BY `lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = NULL WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mSQL (0.7ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `rgt` = NULL WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mSQL (1.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 12 WHERE (`categories`.`id` = 6)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mSQL (3.0ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (6.2ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 1 WHERE (`categories`.`id` = 3)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `rgt` = 10 WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mSQL (0.6ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` < 4) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 5) AND (`categories`.`lft` < 8) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 2) AND (`categories`.`lft` < 2) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) AND (`categories`.id != 1) AND (`categories`.`lft` < 1) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 3) AND (`categories`.id != 4) AND (`categories`.`lft` < 5) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 2)[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) AND (`categories`.id != 4)[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` < 4) ORDER BY `categories`.`lft` DESC LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.9ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 3 THEN `lft` + 7 - 3 WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 2 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 3 THEN `rgt` + 7 - 3 WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 2 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN 1 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` < 2) ORDER BY `categories`.`lft` DESC LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` > 2) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (4.3ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.7ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) AND (`categories`.id != 1) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` > 4) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 9 - 7 WHEN `lft` BETWEEN 8 AND 9 THEN `lft` + 4 - 8 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 9 - 7 WHEN `rgt` BETWEEN 8 AND 9 THEN `rgt` + 4 - 8 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN 1 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` > 6) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` < 6) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Node-1', NULL, NULL, 14)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (15, 'Node-2', NULL, NULL, 16)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (17, 'Node-3', NULL, NULL, 18)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 19) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 20) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 14 AND 14 THEN `lft` + 16 - 14 WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 14 - 15 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 14 AND 14 THEN `rgt` + 16 - 14 WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 14 - 15 ELSE `rgt` END, `parent_id` = CASE WHEN id = 20 THEN 19 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 19) LIMIT 1
  [1m[36mCategory Load (0.8ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 20) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 19) LIMIT 1[0m
  [1m[35mCategory Load (0.2ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 21) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 16 AND 16 THEN `lft` + 18 - 16 WHEN `lft` BETWEEN 17 AND 18 THEN `lft` + 16 - 17 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 16 AND 16 THEN `rgt` + 18 - 16 WHEN `rgt` BETWEEN 17 AND 18 THEN `rgt` + 16 - 17 ELSE `rgt` END, `parent_id` = CASE WHEN id = 21 THEN 19 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.6ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 19) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 21) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` DESC LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 13 AND `categories`.`rgt` <= 18) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.5ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 14 AND `categories`.`rgt` >= 15) AND (`categories`.id != 20)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 16 AND `categories`.`rgt` >= 17) AND (`categories`.id != 21)
  [1m[36mSQL (0.5ms)[0m  [1mUPDATE `categories` SET lft = null, rgt = null [0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 1 ) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.6ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 2 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 2, `rgt` = 3 WHERE (`categories`.`id` = 2)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 3 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 4 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 5, `rgt` = 6 WHERE (`categories`.`id` = 4)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 4, `rgt` = 7 WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 5 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 8, `rgt` = 9 WHERE (`categories`.`id` = 5)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 1, `rgt` = 10 WHERE (`categories`.`id` = 1)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.9ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 6 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 11, `rgt` = 12 WHERE (`categories`.`id` = 6)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 19 ) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 20 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 14, `rgt` = 15 WHERE (`categories`.`id` = 20)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 21 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 16, `rgt` = 17 WHERE (`categories`.`id` = 21)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  UPDATE `categories` SET `lft` = 13, `rgt` = 18 WHERE (`categories`.`id` = 19)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` DESC LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 13 AND `categories`.`rgt` <= 18) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 14 AND `categories`.`rgt` >= 15) AND (`categories`.id != 20)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 16 AND `categories`.`rgt` >= 17) AND (`categories`.id != 21)[0m
  [1m[35mSQL (1.4ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Root1', NULL, NULL, 14)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (15, 'Root2', NULL, NULL, 16)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (17, 'Root3', NULL, NULL, 18)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 22) LIMIT 1[0m
  [1m[35mCategory Load (0.2ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 23) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 14 AND 14 THEN `lft` + 16 - 14 WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 14 - 15 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 14 AND 14 THEN `rgt` + 16 - 14 WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 14 - 15 ELSE `rgt` END, `parent_id` = CASE WHEN id = 23 THEN 22 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 22) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 23) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 22) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 24) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 16 AND 16 THEN `lft` + 18 - 16 WHEN `lft` BETWEEN 17 AND 18 THEN `lft` + 16 - 17 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 16 AND 16 THEN `rgt` + 18 - 16 WHEN `rgt` BETWEEN 17 AND 18 THEN `rgt` + 16 - 17 ELSE `rgt` END, `parent_id` = CASE WHEN id = 24 THEN 22 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 22) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 24) LIMIT 1[0m
  [1m[35mCategory Load (0.7ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` DESC LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 13 AND `categories`.`rgt` <= 18) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 14 AND `categories`.`rgt` >= 15) AND (`categories`.id != 23)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 16 AND `categories`.`rgt` >= 17) AND (`categories`.id != 24)[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET lft = null, rgt = null 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 1 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 2 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = 2, `rgt` = 3 WHERE (`categories`.`id` = 2)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 3 ) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 4 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 5, `rgt` = 6 WHERE (`categories`.`id` = 4)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 4, `rgt` = 7 WHERE (`categories`.`id` = 3)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 5 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 8, `rgt` = 9 WHERE (`categories`.`id` = 5)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 1, `rgt` = 10 WHERE (`categories`.`id` = 1)[0m
  [1m[35mSQL (0.6ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 6 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 11, `rgt` = 12 WHERE (`categories`.`id` = 6)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 22 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 23 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 14, `rgt` = 15 WHERE (`categories`.`id` = 23)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.6ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 24 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 16, `rgt` = 17 WHERE (`categories`.`id` = 24)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = 13, `rgt` = 18 WHERE (`categories`.`id` = 22)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` DESC LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 13 AND `categories`.`rgt` <= 18) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 14 AND `categories`.`rgt` >= 15) AND (`categories`.id != 23)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 16 AND `categories`.`rgt` >= 17) AND (`categories`.id != 24)
  [1m[36mSQL (1.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 3 THEN `lft` + 8 - 3 WHEN `lft` BETWEEN 4 AND 8 THEN `lft` + 2 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 3 THEN `rgt` + 8 - 3 WHEN `rgt` BETWEEN 4 AND 8 THEN `rgt` + 2 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 2 THEN 5 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'New Child', NULL, NULL, 14)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 25) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 10 AND 12 THEN `lft` + 14 - 12 WHEN `lft` BETWEEN 13 AND 14 THEN `lft` + 10 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 10 AND 12 THEN `rgt` + 14 - 12 WHEN `rgt` BETWEEN 13 AND 14 THEN `rgt` + 10 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 25 THEN 1 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 25) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft` DESC LIMIT 1
  [1m[36mSQL (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 7 THEN `lft` + 9 - 7 WHEN `lft` BETWEEN 8 AND 9 THEN `lft` + 2 - 8 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 7 THEN `rgt` + 9 - 7 WHEN `rgt` BETWEEN 8 AND 9 THEN `rgt` + 2 - 8 ELSE `rgt` END, `parent_id` = CASE WHEN id = 5 THEN 1 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 5) AND (`categories`.`lft` < 2) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 5) AND (`categories`.`lft` > 2) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 3 THEN `lft` + 9 - 3 WHEN `lft` BETWEEN 4 AND 9 THEN `lft` + 2 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 3 THEN `rgt` + 9 - 3 WHEN `rgt` BETWEEN 4 AND 9 THEN `rgt` + 2 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 2 THEN 1 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.2ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 2) AND (`categories`.`lft` > 8) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 2) AND (`categories`.`lft` < 8) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 1 AND 3 THEN `lft` + 7 - 3 WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 1 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 1 AND 3 THEN `rgt` + 7 - 3 WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 1 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN NULL ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mSQL (6.2ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 4)
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, NULL, NULL, NULL, 14)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (15, NULL, NULL, NULL, 16)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (17, NULL, NULL, NULL, 18)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (19, NULL, NULL, NULL, 20)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 26) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 27) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 14 AND 14 THEN `lft` + 16 - 14 WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 14 - 15 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 14 AND 14 THEN `rgt` + 16 - 14 WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 14 - 15 ELSE `rgt` END, `parent_id` = CASE WHEN id = 27 THEN 26 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 26) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 27) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.7ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 26) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 28) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 16 AND 16 THEN `lft` + 18 - 16 WHEN `lft` BETWEEN 17 AND 18 THEN `lft` + 16 - 17 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 16 AND 16 THEN `rgt` + 18 - 16 WHEN `rgt` BETWEEN 17 AND 18 THEN `rgt` + 16 - 17 ELSE `rgt` END, `parent_id` = CASE WHEN id = 28 THEN 26 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.6ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 26) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 28) LIMIT 1
  [1m[36mCategory Load (0.6ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 27) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 29) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 15 AND 18 THEN `lft` + 20 - 18 WHEN `lft` BETWEEN 19 AND 20 THEN `lft` + 15 - 19 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 15 AND 18 THEN `rgt` + 20 - 18 WHEN `rgt` BETWEEN 19 AND 20 THEN `rgt` + 15 - 19 ELSE `rgt` END, `parent_id` = CASE WHEN id = 29 THEN 27 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 27) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 29) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (2.6ms)[0m  ROLLBACK
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mSELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 2)[0m
  [1m[35mSQL (0.8ms)[0m  describe `notes`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('A', 1, 2, 'Category', NULL, 2)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 2)
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('B', 3, 2, 'Category', NULL, 4)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Default') AND (`notes`.`notable_id` = 2)
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('C', 1, 2, 'Default', NULL, 2)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 2) AND (`notes`.`parent_id` IS NULL) ORDER BY `notes`.`lft`[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`notable_type` = 'Default') AND (`notes`.`notable_id` = 2) AND (`notes`.`parent_id` IS NULL) ORDER BY `notes`.`lft`
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mNote Load (0.8ms)[0m  SELECT `notable_id`, `notable_type`, `lft`, COUNT(`lft`) FROM `notes` GROUP BY `notable_id`, `notable_type`, `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mNote Load (0.7ms)[0m  [1mSELECT `notable_id`, `notable_type`, `rgt`, COUNT(`rgt`) FROM `notes` GROUP BY `notable_id`, `notable_type`, `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mSELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 3)[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('A', 1, 3, 'Category', NULL, 2)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 3)[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('B', 3, 3, 'Category', NULL, 4)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.5ms)[0m  [1mSELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 3)[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('C', 5, 3, 'Category', NULL, 6)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 9) LIMIT 1[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 10) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `notes` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 2 THEN `lft` + 4 - 2 WHEN `lft` BETWEEN 3 AND 4 THEN `lft` + 2 - 3 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 2 THEN `rgt` + 4 - 2 WHEN `rgt` BETWEEN 3 AND 4 THEN `rgt` + 2 - 3 ELSE `rgt` END, `parent_id` = CASE WHEN id = 10 THEN 9 ELSE `parent_id` END WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 9) LIMIT 1[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 10) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 9) LIMIT 1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 11) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `notes` SET `lft` = CASE WHEN `lft` BETWEEN 4 AND 4 THEN `lft` + 6 - 4 WHEN `lft` BETWEEN 5 AND 6 THEN `lft` + 4 - 5 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 4 AND 4 THEN `rgt` + 6 - 4 WHEN `rgt` BETWEEN 5 AND 6 THEN `rgt` + 4 - 5 ELSE `rgt` END, `parent_id` = CASE WHEN id = 11 THEN 9 ELSE `parent_id` END WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 3)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 9) LIMIT 1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 11) LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  UPDATE `notes` SET lft = null, rgt = null 
  [1m[36mNote Load (0.5ms)[0m  [1mSELECT `notes`.`id` FROM `notes` LEFT OUTER JOIN `notes` AS parent ON `notes`.`parent_id` = parent.id WHERE (`notes`.`lft` IS NULL OR `notes`.`rgt` IS NULL OR `notes`.`lft` >= `notes`.`rgt` OR (`notes`.`parent_id` IS NOT NULL AND (`notes`.`lft` <= parent.`lft` OR `notes`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`parent_id` IS NULL) ORDER BY `lft`, `rgt`, id
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`parent_id` = 1 AND `notable_id` = 1 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`parent_id` = 2 AND `notable_id` = 1 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `notes` SET `lft` = 2, `rgt` = 3 WHERE (`notes`.`id` = 2)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`parent_id` = 3 AND `notable_id` = 1 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `notes` SET `lft` = 4, `rgt` = 5 WHERE (`notes`.`id` = 3)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`parent_id` = 4 AND `notable_id` = 1 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `notes` SET `lft` = 6, `rgt` = 7 WHERE (`notes`.`id` = 4)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `notes` SET `lft` = 1, `rgt` = 8 WHERE (`notes`.`id` = 1)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`parent_id` = 5 AND `notable_id` = 1 AND `notable_type` = 'Departments' ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `notes` SET `lft` = 1, `rgt` = 2 WHERE (`notes`.`id` = 5)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`parent_id` = 9 AND `notable_id` = 3 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`parent_id` = 10 AND `notable_id` = 3 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `notes` SET `lft` = 2, `rgt` = 3 WHERE (`notes`.`id` = 10)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`parent_id` = 11 AND `notable_id` = 3 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `notes` SET `lft` = 4, `rgt` = 5 WHERE (`notes`.`id` = 11)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `notes` SET `lft` = 1, `rgt` = 6 WHERE (`notes`.`id` = 9)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`parent_id` IS NULL) AND (`notes`.`body` = 'A') ORDER BY `lft` LIMIT 1[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`parent_id` IS NULL) AND (`notes`.`body` = 'A') ORDER BY `lft` LIMIT 1
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.`id`, `notes`.`body`, `notes`.`parent_id`, `notes`.`lft`, `notes`.`rgt`, `notes`.`notable_id`, `notes`.`notable_type` FROM `notes` WHERE (`notes`.parent_id = 9) ORDER BY `lft`[0m
  [1m[35mSQL (1.3ms)[0m  ROLLBACK
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` < 4) ORDER BY `categories`.`lft` DESC LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 3 THEN `lft` + 7 - 3 WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 2 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 3 THEN `rgt` + 7 - 3 WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 2 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN 1 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft`
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.0ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (6.8ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 2)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 4 AND `categories`.`rgt` >= 7) AND (`categories`.id != 3)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) AND (`categories`.id != 4)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 8 AND `categories`.`rgt` >= 9) AND (`categories`.id != 5)[0m
  [1m[35mSQL (0.5ms)[0m  UPDATE `categories` SET lft = null, rgt = null 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 1 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 2 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 2, `rgt` = 3 WHERE (`categories`.`id` = 2)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 3 ) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 4 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 5, `rgt` = 6 WHERE (`categories`.`id` = 4)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 4, `rgt` = 7 WHERE (`categories`.`id` = 3)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.7ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 5 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 8, `rgt` = 9 WHERE (`categories`.`id` = 5)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 1, `rgt` = 10 WHERE (`categories`.`id` = 1)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 6 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 11, `rgt` = 12 WHERE (`categories`.`id` = 6)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.6ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 2)[0m
  [1m[35mSQL (0.7ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 4 AND `categories`.`rgt` >= 7) AND (`categories`.id != 3)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) AND (`categories`.id != 4)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 8 AND `categories`.`rgt` >= 9) AND (`categories`.id != 5)
  [1m[36mSQL (1.0ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` > 4) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 2) AND (`categories`.`lft` > 2) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 5) AND (`categories`.`lft` > 8) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) AND (`categories`.id != 1) AND (`categories`.`lft` > 1) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) AND (`categories`.id != 6) AND (`categories`.`lft` > 11) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 3) AND (`categories`.id != 4) AND (`categories`.`lft` > 5) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` <= 8 AND `categories`.`rgt` >= 9) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mScopedCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1[0m
  [1m[35mScopedCategory Load (0.4ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft` LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `organization_id` = 0 WHERE (`categories`.`id` = 2)[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 1) LIMIT 1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 2) LIMIT 1[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 5) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.0ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.0ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) AND (`categories`.id != 1) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) ORDER BY `categories`.`lft`
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'New Top', NULL, NULL, 14)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 30) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 11 AND 12 THEN `lft` + 13 - 12 WHEN `lft` BETWEEN 13 AND 13 THEN `lft` + 11 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 11 AND 12 THEN `rgt` + 13 - 12 WHEN `rgt` BETWEEN 13 AND 13 THEN `rgt` + 11 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 6 THEN 30 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 30) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.8ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 3 AND 3 THEN `lft` + 7 - 3 WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 3 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 3 AND 3 THEN `rgt` + 7 - 3 WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 3 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN 2 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.6ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  DELETE FROM `categories` WHERE (`categories`.`id` = 3)
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET lft = null [0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET rgt = null [0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mSQL (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 0 WHERE (`categories`.`id` = 6)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 2)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 4 AND `categories`.`rgt` >= 7) AND (`categories`.id != 3)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) AND (`categories`.id != 4)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 8 AND `categories`.`rgt` >= 9) AND (`categories`.id != 5)
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 11 AND `categories`.`rgt` <= 12) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 8 AND `categories`.`rgt` >= 9) AND (`categories`.id != 5)
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 11 AND `categories`.`rgt` <= 12) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.5ms)[0m  [1mSHOW TABLES[0m
  [1m[35mSQL (7.8ms)[0m  DROP TABLE `categories`
  [1m[36mSQL (2.8ms)[0m  [1mCREATE TABLE `categories` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `name` varchar(255), `parent_id` int(11), `lft` int(11), `rgt` int(11), `organization_id` int(11)) ENGINE=InnoDB[0m
  [1m[35mSQL (0.3ms)[0m  SHOW TABLES
  [1m[36mSQL (1.2ms)[0m  [1mDROP TABLE `departments`[0m
  [1m[35mSQL (2.8ms)[0m  CREATE TABLE `departments` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `name` varchar(255)) ENGINE=InnoDB
  [1m[36mSQL (0.3ms)[0m  [1mSHOW TABLES[0m
  [1m[35mSQL (1.5ms)[0m  DROP TABLE `notes`
  [1m[36mSQL (2.9ms)[0m  [1mCREATE TABLE `notes` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `body` text, `parent_id` int(11), `lft` int(11), `rgt` int(11), `notable_id` int(11), `notable_type` varchar(255)) ENGINE=InnoDB[0m
  [1m[35mSQL (0.3ms)[0m  SHOW TABLES
  [1m[36mSQL (1.4ms)[0m  [1mDROP TABLE `renamed_columns`[0m
  [1m[35mSQL (2.7ms)[0m  CREATE TABLE `renamed_columns` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `name` varchar(255), `mother_id` int(11), `red` int(11), `black` int(11)) ENGINE=InnoDB
  [1m[36mSQL (0.3ms)[0m  [1mSHOW TABLES[0m
  [1m[35mSQL (0.1ms)[0m  SELECT version FROM `schema_migrations`
Unable to load category, underlying cause No such file to load -- category 

 /home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:284:in `depend_on'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:196:in `require_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:850:in `try_to_load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:865:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:845:in `fixtures'
./test/test_helper.rb:31
./test/awesome_nested_set_test.rb:1:in `require'
./test/awesome_nested_set_test.rb:1
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
Unable to load note, underlying cause No such file to load -- note 

 /home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:284:in `depend_on'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:196:in `require_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:850:in `try_to_load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:865:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:845:in `fixtures'
./test/test_helper.rb:31
./test/awesome_nested_set_test.rb:1:in `require'
./test/awesome_nested_set_test.rb:1
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
Unable to load department, underlying cause No such file to load -- department 

 /home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:284:in `depend_on'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:196:in `require_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:850:in `try_to_load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:865:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:845:in `fixtures'
./test/test_helper.rb:31
./test/awesome_nested_set_test.rb:1:in `require'
./test/awesome_nested_set_test.rb:1
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
Unable to load category, underlying cause No such file to load -- category 

 /home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:284:in `depend_on'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:196:in `require_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:850:in `try_to_load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:865:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:862:in `require_fixture_classes'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activerecord-3.0.0.rc/lib/active_record/fixtures.rb:845:in `fixtures'
./test/awesome_nested_set/helper_test.rb:8
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:215:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:215:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:205:in `load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:570:in `new_constants_in'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:205:in `load_dependency'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/activesupport-3.0.0.rc/lib/active_support/dependencies.rb:215:in `load'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
/home/mrblue/.rvm/gems/ruby-1.8.7-p302/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.3ms)[0m  SHOW TABLES
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) AND (`categories`.id != 4) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.8ms)[0m  describe `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Child', NULL, 3, 14)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 7) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 7 AND 12 THEN `lft` + 14 - 12 WHEN `lft` BETWEEN 13 AND 14 THEN `lft` + 7 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 7 AND 12 THEN `rgt` + 14 - 12 WHEN `rgt` BETWEEN 13 AND 14 THEN `rgt` + 7 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 7 THEN 3 ELSE `parent_id` END 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 7) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `parent_id` = 5 WHERE (`categories`.`id` = 4)
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 5 AND 6 THEN `lft` + 8 - 6 WHEN `lft` BETWEEN 7 AND 8 THEN `lft` + 5 - 7 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 5 AND 6 THEN `rgt` + 8 - 6 WHEN `rgt` BETWEEN 7 AND 8 THEN `rgt` + 5 - 7 ELSE `rgt` END, `parent_id` = CASE WHEN id = 4 THEN 5 ELSE `parent_id` END [0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (7.1ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'New Root', NULL, NULL, 14)
  [1m[36mSQL (0.4ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.6ms)[0m  UPDATE `categories` SET `parent_id` = NULL WHERE (`categories`.`id` = 4)
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 1 AND 4 THEN `lft` + 6 - 4 WHEN `lft` BETWEEN 5 AND 6 THEN `lft` + 1 - 5 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 1 AND 4 THEN `rgt` + 6 - 4 WHEN `rgt` BETWEEN 5 AND 6 THEN `rgt` + 1 - 5 ELSE `rgt` END, `parent_id` = CASE WHEN id = 4 THEN NULL ELSE `parent_id` END 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.6ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Child', NULL, 3, 14)
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 9) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 7 AND 12 THEN `lft` + 14 - 12 WHEN `lft` BETWEEN 13 AND 14 THEN `lft` + 7 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 7 AND 12 THEN `rgt` + 14 - 12 WHEN `rgt` BETWEEN 13 AND 14 THEN `rgt` + 7 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 9 THEN 3 ELSE `parent_id` END [0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 9) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.8ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `parent_id` = 5 WHERE (`categories`.`id` = 4)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 5 AND 6 THEN `lft` + 8 - 6 WHEN `lft` BETWEEN 7 AND 8 THEN `lft` + 5 - 7 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 5 AND 6 THEN `rgt` + 8 - 6 WHEN `rgt` BETWEEN 7 AND 8 THEN `rgt` + 5 - 7 ELSE `rgt` END, `parent_id` = CASE WHEN id = 4 THEN 5 ELSE `parent_id` END 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 1 AND 3 THEN `lft` + 7 - 3 WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 1 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 1 AND 3 THEN `rgt` + 7 - 3 WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 1 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN NULL ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.2ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `parent_id` = 3 WHERE (`categories`.`id` = 5)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 7 AND 7 THEN `lft` + 9 - 7 WHEN `lft` BETWEEN 8 AND 9 THEN `lft` + 7 - 8 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 7 AND 7 THEN `rgt` + 9 - 7 WHEN `rgt` BETWEEN 8 AND 9 THEN `rgt` + 7 - 8 ELSE `rgt` END, `parent_id` = CASE WHEN id = 5 THEN 3 ELSE `parent_id` END 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.7ms)[0m  [1mSELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
WARNING: Can't mass-assign protected attributes: lft, rgt
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Child', NULL, 3, 14)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 10) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 7 AND 12 THEN `lft` + 14 - 12 WHEN `lft` BETWEEN 13 AND 14 THEN `lft` + 7 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 7 AND 12 THEN `rgt` + 14 - 12 WHEN `rgt` BETWEEN 13 AND 14 THEN `rgt` + 7 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 10 THEN 3 ELSE `parent_id` END 
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 10) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (1.1ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`renamed_columns`.`black`) AS max_id FROM `renamed_columns`
  [1m[36mSQL (0.9ms)[0m  [1mdescribe `renamed_columns`[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `renamed_columns` (`black`, `mother_id`, `name`, `red`) VALUES (2, NULL, NULL, 1)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  DELETE FROM `categories` WHERE (`categories`.`lft` > 4 AND `categories`.`rgt` < 7)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = (`lft` - 4) WHERE (`lft` > 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `categories` SET `rgt` = (`rgt` - 4) WHERE (`rgt` > 7)
  [1m[36mSQL (0.2ms)[0m  [1mDELETE FROM `categories` WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'lawyers', NULL, NULL, 14)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (15, 'United States', NULL, NULL, 16)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 11) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 12) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 14 AND 14 THEN `lft` + 16 - 14 WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 14 - 15 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 14 AND 14 THEN `rgt` + 16 - 14 WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 14 - 15 ELSE `rgt` END, `parent_id` = CASE WHEN id = 12 THEN 11 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 11) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 12) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (17, 'Patent Law', NULL, NULL, 18)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 12) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 13) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 18 - 16 WHEN `lft` BETWEEN 17 AND 18 THEN `lft` + 15 - 17 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 18 - 16 WHEN `rgt` BETWEEN 17 AND 18 THEN `rgt` + 15 - 17 ELSE `rgt` END, `parent_id` = CASE WHEN id = 13 THEN 12 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 12) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 13) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 11) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.parent_id = 11)
  [1m[36mSQL (0.5ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.parent_id = 12)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` >= 13 AND `categories`.`rgt` <= 18) AND (`categories`.id != 11)
  [1m[36mSQL (2.2ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 4 AND `categories`.`rgt` <= 7) AND (`categories`.id != 3) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.3ms)[0m  DELETE FROM `categories` WHERE (`categories`.`id` = 4)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = (`lft` - 4) WHERE (`lft` > 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `categories` SET `rgt` = (`rgt` - 4) WHERE (`rgt` > 7)
  [1m[36mSQL (0.2ms)[0m  [1mDELETE FROM `categories` WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.6ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 4 AND `categories`.`rgt` <= 7) AND (`categories`.id != 3) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (6.8ms)[0m  DELETE FROM `categories` WHERE (`categories`.`id` = 4)
  [1m[36mSQL (0.5ms)[0m  [1mUPDATE `categories` SET `lft` = (`lft` - 4) WHERE (`lft` > 7)[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `rgt` = (`rgt` - 4) WHERE (`rgt` > 7)
  [1m[36mSQL (0.2ms)[0m  [1mDELETE FROM `categories` WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'New Top', NULL, NULL, 14)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 14) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mSQL (1.2ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 1 AND 10 THEN `lft` + 13 - 10 WHEN `lft` BETWEEN 11 AND 13 THEN `lft` + 1 - 11 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 1 AND 10 THEN `rgt` + 13 - 10 WHEN `rgt` BETWEEN 11 AND 13 THEN `rgt` + 1 - 11 ELSE `rgt` END, `parent_id` = CASE WHEN id = 1 THEN 14 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 14) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) ORDER BY `categories`.`lft`
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`name` = 'Child 1') LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Child 1.1', NULL, NULL, 14)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (6.8ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (15, 'Child 1.1.1', NULL, NULL, 16)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (17, 'Child 1.1.1.1', NULL, NULL, 18)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (19, 'Child 1.2', NULL, NULL, 20)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.8ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 15) LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 3 AND 12 THEN `lft` + 14 - 12 WHEN `lft` BETWEEN 13 AND 14 THEN `lft` + 3 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 3 AND 12 THEN `rgt` + 14 - 12 WHEN `rgt` BETWEEN 13 AND 14 THEN `rgt` + 3 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 15 THEN 2 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 15) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 15) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 16) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 4 AND 14 THEN `lft` + 16 - 14 WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 4 - 15 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 4 AND 14 THEN `rgt` + 16 - 14 WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 4 - 15 ELSE `rgt` END, `parent_id` = CASE WHEN id = 16 THEN 15 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 15) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 16) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 16) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 17) LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 5 AND 16 THEN `lft` + 18 - 16 WHEN `lft` BETWEEN 17 AND 18 THEN `lft` + 5 - 17 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 5 AND 16 THEN `rgt` + 18 - 16 WHEN `rgt` BETWEEN 17 AND 18 THEN `rgt` + 5 - 17 ELSE `rgt` END, `parent_id` = CASE WHEN id = 17 THEN 16 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 16) LIMIT 1[0m
  [1m[35mCategory Load (0.2ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 17) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 18) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 9 AND 18 THEN `lft` + 20 - 18 WHEN `lft` BETWEEN 19 AND 20 THEN `lft` + 9 - 19 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 9 AND 18 THEN `rgt` + 20 - 18 WHEN `rgt` BETWEEN 19 AND 20 THEN `rgt` + 9 - 19 ELSE `rgt` END, `parent_id` = CASE WHEN id = 18 THEN 2 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 18) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 18) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (1.3ms)[0m  ROLLBACK
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 1) LIMIT 1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mNote Load (0.1ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 1) LIMIT 1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 2) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.parent_id = 4)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.parent_id = 3)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.parent_id = 1)[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.7ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mScopedCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1
  [1m[36mScopedCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft` LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `organization_id` = 0 WHERE (`categories`.`id` = 2)
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mScopedCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1[0m
  [1m[35mScopedCategory Load (0.4ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft` LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `organization_id` = 0 WHERE (`categories`.`id` = 2)[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (rgt - lft = 1)[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`rgt` - `lft` = 1) ORDER BY `lft`
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`rgt` - `lft` = 1)[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`rgt` - `lft` = 1) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`rgt` - `lft` = 1) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`rgt` - `lft` = 1) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`rgt` - `lft` = 1) ORDER BY `lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = NULL WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `rgt` = NULL WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 12 WHERE (`categories`.`id` = 6)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 1 WHERE (`categories`.`id` = 3)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `rgt` = 10 WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.0ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` < 4) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 5) AND (`categories`.`lft` < 8) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 2) AND (`categories`.`lft` < 2) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) AND (`categories`.id != 1) AND (`categories`.`lft` < 1) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 3) AND (`categories`.id != 4) AND (`categories`.`lft` < 5) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 2)[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) AND (`categories`.id != 4)[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` < 4) ORDER BY `categories`.`lft` DESC LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 3 THEN `lft` + 7 - 3 WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 2 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 3 THEN `rgt` + 7 - 3 WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 2 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN 1 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` < 2) ORDER BY `categories`.`lft` DESC LIMIT 1[0m
  [1m[35mCategory Load (1.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` > 2) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) AND (`categories`.id != 1) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` > 4) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 9 - 7 WHEN `lft` BETWEEN 8 AND 9 THEN `lft` + 4 - 8 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 9 - 7 WHEN `rgt` BETWEEN 8 AND 9 THEN `rgt` + 4 - 8 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN 1 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` > 6) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` < 6) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Node-1', NULL, NULL, 14)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (15, 'Node-2', NULL, NULL, 16)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (17, 'Node-3', NULL, NULL, 18)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 19) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 20) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 14 AND 14 THEN `lft` + 16 - 14 WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 14 - 15 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 14 AND 14 THEN `rgt` + 16 - 14 WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 14 - 15 ELSE `rgt` END, `parent_id` = CASE WHEN id = 20 THEN 19 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 19) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 20) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 19) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 21) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 16 AND 16 THEN `lft` + 18 - 16 WHEN `lft` BETWEEN 17 AND 18 THEN `lft` + 16 - 17 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 16 AND 16 THEN `rgt` + 18 - 16 WHEN `rgt` BETWEEN 17 AND 18 THEN `rgt` + 16 - 17 ELSE `rgt` END, `parent_id` = CASE WHEN id = 21 THEN 19 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 19) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 21) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` DESC LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 13 AND `categories`.`rgt` <= 18) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 14 AND `categories`.`rgt` >= 15) AND (`categories`.id != 20)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 16 AND `categories`.`rgt` >= 17) AND (`categories`.id != 21)
  [1m[36mSQL (0.7ms)[0m  [1mUPDATE `categories` SET lft = null, rgt = null [0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 1 ) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 2 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 2, `rgt` = 3 WHERE (`categories`.`id` = 2)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 3 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mCategory Load (0.7ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 4 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 5, `rgt` = 6 WHERE (`categories`.`id` = 4)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 4, `rgt` = 7 WHERE (`categories`.`id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 5 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 8, `rgt` = 9 WHERE (`categories`.`id` = 5)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 1, `rgt` = 10 WHERE (`categories`.`id` = 1)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 6 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 11, `rgt` = 12 WHERE (`categories`.`id` = 6)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 19 ) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 20 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 14, `rgt` = 15 WHERE (`categories`.`id` = 20)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 21 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 16, `rgt` = 17 WHERE (`categories`.`id` = 21)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.6ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 13, `rgt` = 18 WHERE (`categories`.`id` = 19)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` DESC LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 13 AND `categories`.`rgt` <= 18) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 14 AND `categories`.`rgt` >= 15) AND (`categories`.id != 20)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 16 AND `categories`.`rgt` >= 17) AND (`categories`.id != 21)[0m
  [1m[35mSQL (1.4ms)[0m  ROLLBACK
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'Root1', NULL, NULL, 14)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (15, 'Root2', NULL, NULL, 16)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (17, 'Root3', NULL, NULL, 18)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 22) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 23) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 14 AND 14 THEN `lft` + 16 - 14 WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 14 - 15 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 14 AND 14 THEN `rgt` + 16 - 14 WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 14 - 15 ELSE `rgt` END, `parent_id` = CASE WHEN id = 23 THEN 22 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 22) LIMIT 1[0m
  [1m[35mCategory Load (0.2ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 23) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 22) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 24) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 16 AND 16 THEN `lft` + 18 - 16 WHEN `lft` BETWEEN 17 AND 18 THEN `lft` + 16 - 17 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 16 AND 16 THEN `rgt` + 18 - 16 WHEN `rgt` BETWEEN 17 AND 18 THEN `rgt` + 16 - 17 ELSE `rgt` END, `parent_id` = CASE WHEN id = 24 THEN 22 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 22) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 24) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` DESC LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 13 AND `categories`.`rgt` <= 18) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 14 AND `categories`.`rgt` >= 15) AND (`categories`.id != 23)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 16 AND `categories`.`rgt` >= 17) AND (`categories`.id != 24)[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET lft = null, rgt = null 
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 1 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 2 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 2, `rgt` = 3 WHERE (`categories`.`id` = 2)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 3 ) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 4 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 5, `rgt` = 6 WHERE (`categories`.`id` = 4)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 4, `rgt` = 7 WHERE (`categories`.`id` = 3)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 5 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 8, `rgt` = 9 WHERE (`categories`.`id` = 5)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 1, `rgt` = 10 WHERE (`categories`.`id` = 1)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 6 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 11, `rgt` = 12 WHERE (`categories`.`id` = 6)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 22 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 23 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 14, `rgt` = 15 WHERE (`categories`.`id` = 23)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 24 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 16, `rgt` = 17 WHERE (`categories`.`id` = 24)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (1.0ms)[0m  [1mUPDATE `categories` SET `lft` = 13, `rgt` = 18 WHERE (`categories`.`id` = 22)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` DESC LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 13 AND `categories`.`rgt` <= 18) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 14 AND `categories`.`rgt` >= 15) AND (`categories`.id != 23)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 16 AND `categories`.`rgt` >= 17) AND (`categories`.id != 24)
  [1m[36mSQL (1.4ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mCategory Load (0.8ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 3 THEN `lft` + 8 - 3 WHEN `lft` BETWEEN 4 AND 8 THEN `lft` + 2 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 3 THEN `rgt` + 8 - 3 WHEN `rgt` BETWEEN 4 AND 8 THEN `rgt` + 2 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 2 THEN 5 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.6ms)[0m  [1mSELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'New Child', NULL, NULL, 14)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 25) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 10 AND 12 THEN `lft` + 14 - 12 WHEN `lft` BETWEEN 13 AND 14 THEN `lft` + 10 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 10 AND 12 THEN `rgt` + 14 - 12 WHEN `rgt` BETWEEN 13 AND 14 THEN `rgt` + 10 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 25 THEN 1 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.6ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 25) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft` DESC LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 7 THEN `lft` + 9 - 7 WHEN `lft` BETWEEN 8 AND 9 THEN `lft` + 2 - 8 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 7 THEN `rgt` + 9 - 7 WHEN `rgt` BETWEEN 8 AND 9 THEN `rgt` + 2 - 8 ELSE `rgt` END, `parent_id` = CASE WHEN id = 5 THEN 1 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 5) AND (`categories`.`lft` < 2) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 5) AND (`categories`.`lft` > 2) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 3 THEN `lft` + 9 - 3 WHEN `lft` BETWEEN 4 AND 9 THEN `lft` + 2 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 3 THEN `rgt` + 9 - 3 WHEN `rgt` BETWEEN 4 AND 9 THEN `rgt` + 2 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 2 THEN 1 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 2) AND (`categories`.`lft` > 8) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 2) AND (`categories`.`lft` < 8) ORDER BY `categories`.`lft` DESC LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 1 AND 3 THEN `lft` + 7 - 3 WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 1 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 1 AND 3 THEN `rgt` + 7 - 3 WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 1 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN NULL ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 4)
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, NULL, NULL, NULL, 14)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (15, NULL, NULL, NULL, 16)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (17, NULL, NULL, NULL, 18)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (19, NULL, NULL, NULL, 20)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 26) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 27) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 14 AND 14 THEN `lft` + 16 - 14 WHEN `lft` BETWEEN 15 AND 16 THEN `lft` + 14 - 15 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 14 AND 14 THEN `rgt` + 16 - 14 WHEN `rgt` BETWEEN 15 AND 16 THEN `rgt` + 14 - 15 ELSE `rgt` END, `parent_id` = CASE WHEN id = 27 THEN 26 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 26) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 27) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (1.1ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 26) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 28) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 16 AND 16 THEN `lft` + 18 - 16 WHEN `lft` BETWEEN 17 AND 18 THEN `lft` + 16 - 17 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 16 AND 16 THEN `rgt` + 18 - 16 WHEN `rgt` BETWEEN 17 AND 18 THEN `rgt` + 16 - 17 ELSE `rgt` END, `parent_id` = CASE WHEN id = 28 THEN 26 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 26) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 28) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 27) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 29) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 15 AND 18 THEN `lft` + 20 - 18 WHEN `lft` BETWEEN 19 AND 20 THEN `lft` + 15 - 19 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 15 AND 18 THEN `rgt` + 20 - 18 WHEN `rgt` BETWEEN 19 AND 20 THEN `rgt` + 15 - 19 ELSE `rgt` END, `parent_id` = CASE WHEN id = 29 THEN 27 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 27) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 29) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (2.5ms)[0m  ROLLBACK
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mSELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 2)[0m
  [1m[35mSQL (0.9ms)[0m  describe `notes`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('A', 1, 2, 'Category', NULL, 2)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 2)
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('B', 3, 2, 'Category', NULL, 4)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Default') AND (`notes`.`notable_id` = 2)
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('C', 1, 2, 'Default', NULL, 2)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 2) AND (`notes`.`parent_id` IS NULL) ORDER BY `notes`.`lft`[0m
  [1m[35mNote Load (0.6ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`notable_type` = 'Default') AND (`notes`.`notable_id` = 2) AND (`notes`.`parent_id` IS NULL) ORDER BY `notes`.`lft`
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mNote Load (0.8ms)[0m  SELECT `notable_id`, `notable_type`, `lft`, COUNT(`lft`) FROM `notes` GROUP BY `notable_id`, `notable_type`, `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mNote Load (0.7ms)[0m  [1mSELECT `notable_id`, `notable_type`, `rgt`, COUNT(`rgt`) FROM `notes` GROUP BY `notable_id`, `notable_type`, `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mSELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 3)[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('A', 1, 3, 'Category', NULL, 2)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mSELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 3)[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('B', 3, 3, 'Category', NULL, 4)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT MAX(`notes`.`rgt`) AS max_id FROM `notes` WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 3)[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `notes` (`body`, `lft`, `notable_id`, `notable_type`, `parent_id`, `rgt`) VALUES ('C', 5, 3, 'Category', NULL, 6)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 9) LIMIT 1[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 10) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `notes` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 2 THEN `lft` + 4 - 2 WHEN `lft` BETWEEN 3 AND 4 THEN `lft` + 2 - 3 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 2 THEN `rgt` + 4 - 2 WHEN `rgt` BETWEEN 3 AND 4 THEN `rgt` + 2 - 3 ELSE `rgt` END, `parent_id` = CASE WHEN id = 10 THEN 9 ELSE `parent_id` END WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 3)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 9) LIMIT 1[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 10) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 9) LIMIT 1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 11) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `notes` SET `lft` = CASE WHEN `lft` BETWEEN 4 AND 4 THEN `lft` + 6 - 4 WHEN `lft` BETWEEN 5 AND 6 THEN `lft` + 4 - 5 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 4 AND 4 THEN `rgt` + 6 - 4 WHEN `rgt` BETWEEN 5 AND 6 THEN `rgt` + 4 - 5 ELSE `rgt` END, `parent_id` = CASE WHEN id = 11 THEN 9 ELSE `parent_id` END WHERE (`notes`.`notable_type` = 'Category') AND (`notes`.`notable_id` = 3)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 9) LIMIT 1
  [1m[36mNote Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `notes` WHERE (`notes`.`id` = 11) LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  UPDATE `notes` SET lft = null, rgt = null 
  [1m[36mNote Load (0.5ms)[0m  [1mSELECT `notes`.`id` FROM `notes` LEFT OUTER JOIN `notes` AS parent ON `notes`.`parent_id` = parent.id WHERE (`notes`.`lft` IS NULL OR `notes`.`rgt` IS NULL OR `notes`.`lft` >= `notes`.`rgt` OR (`notes`.`parent_id` IS NOT NULL AND (`notes`.`lft` <= parent.`lft` OR `notes`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`parent_id` IS NULL) ORDER BY `lft`, `rgt`, id
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`parent_id` = 1 AND `notable_id` = 1 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`parent_id` = 2 AND `notable_id` = 1 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `notes` SET `lft` = 2, `rgt` = 3 WHERE (`notes`.`id` = 2)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`parent_id` = 3 AND `notable_id` = 1 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `notes` SET `lft` = 4, `rgt` = 5 WHERE (`notes`.`id` = 3)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mNote Load (0.7ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`parent_id` = 4 AND `notable_id` = 1 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `notes` SET `lft` = 6, `rgt` = 7 WHERE (`notes`.`id` = 4)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `notes` SET `lft` = 1, `rgt` = 8 WHERE (`notes`.`id` = 1)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`parent_id` = 5 AND `notable_id` = 1 AND `notable_type` = 'Departments' ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `notes` SET `lft` = 1, `rgt` = 2 WHERE (`notes`.`id` = 5)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`parent_id` = 9 AND `notable_id` = 3 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`parent_id` = 10 AND `notable_id` = 3 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `notes` SET `lft` = 2, `rgt` = 3 WHERE (`notes`.`id` = 10)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`parent_id` = 11 AND `notable_id` = 3 AND `notable_type` = 'Category' ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `notes` SET `lft` = 4, `rgt` = 5 WHERE (`notes`.`id` = 11)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `notes` SET `lft` = 1, `rgt` = 6 WHERE (`notes`.`id` = 9)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`parent_id` IS NULL) AND (`notes`.`body` = 'A') ORDER BY `lft` LIMIT 1[0m
  [1m[35mNote Load (0.4ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`parent_id` IS NULL) AND (`notes`.`body` = 'A') ORDER BY `lft` LIMIT 1
  [1m[36mNote Load (0.4ms)[0m  [1mSELECT `notes`.`id`, `notes`.`body`, `notes`.`parent_id`, `notes`.`lft`, `notes`.`rgt`, `notes`.`notable_id`, `notes`.`notable_type` FROM `notes` WHERE (`notes`.parent_id = 9) ORDER BY `lft`[0m
  [1m[35mSQL (334.4ms)[0m  ROLLBACK
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` < 4) ORDER BY `categories`.`lft` DESC LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 2 AND 3 THEN `lft` + 7 - 3 WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 2 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 2 AND 3 THEN `rgt` + 7 - 3 WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 2 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN 1 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft`
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.0ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.6ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 2)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 4 AND `categories`.`rgt` >= 7) AND (`categories`.id != 3)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) AND (`categories`.id != 4)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 8 AND `categories`.`rgt` >= 9) AND (`categories`.id != 5)[0m
  [1m[35mSQL (0.6ms)[0m  UPDATE `categories` SET lft = null, rgt = null 
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 1 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 2 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 2, `rgt` = 3 WHERE (`categories`.`id` = 2)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 3 ) ORDER BY `lft`, `rgt`, id
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 4 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 5, `rgt` = 6 WHERE (`categories`.`id` = 4)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 4, `rgt` = 7 WHERE (`categories`.`id` = 3)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`parent_id` = 5 ) ORDER BY `lft`, `rgt`, id
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `categories` SET `lft` = 8, `rgt` = 9 WHERE (`categories`.`id` = 5)
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 1, `rgt` = 10 WHERE (`categories`.`id` = 1)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`parent_id` = 6 ) ORDER BY `lft`, `rgt`, id[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 11, `rgt` = 12 WHERE (`categories`.`id` = 6)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 2)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 4 AND `categories`.`rgt` >= 7) AND (`categories`.id != 3)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) AND (`categories`.id != 4)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 8 AND `categories`.`rgt` >= 9) AND (`categories`.id != 5)
  [1m[36mSQL (1.2ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) AND (`categories`.`lft` > 4) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 2) AND (`categories`.`lft` > 2) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 5) AND (`categories`.`lft` > 8) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) AND (`categories`.id != 1) AND (`categories`.`lft` > 1) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) AND (`categories`.id != 6) AND (`categories`.`lft` > 11) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 3) AND (`categories`.id != 4) AND (`categories`.`lft` > 5) ORDER BY `categories`.`lft` LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` <= 8 AND `categories`.`rgt` >= 9) ORDER BY `categories`.`lft` LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL)[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mScopedCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft` LIMIT 1[0m
  [1m[35mScopedCategory Load (0.4ms)[0m  SELECT `categories`.`id`, `categories`.`name`, `categories`.`parent_id`, `categories`.`lft`, `categories`.`rgt`, `categories`.`organization_id` FROM `categories` WHERE (`categories`.parent_id = 1) ORDER BY `lft` LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `organization_id` = 0 WHERE (`categories`.`id` = 2)[0m
  [1m[35mSQL (0.8ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 1) LIMIT 1
  [1m[36mNote Load (0.8ms)[0m  [1mSELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 2) LIMIT 1[0m
  [1m[35mNote Load (0.3ms)[0m  SELECT `notes`.* FROM `notes` WHERE (`notes`.`id` = 5) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.0ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.0ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 4) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) AND (`categories`.id != 1) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) ORDER BY `categories`.`lft`
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 1) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 5) LIMIT 1
  [1m[36mCategory Load (0.5ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` = 1) AND (`categories`.id != 3) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT MAX(`categories`.`rgt`) AS max_id FROM `categories`
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `categories` (`lft`, `name`, `organization_id`, `parent_id`, `rgt`) VALUES (13, 'New Top', NULL, NULL, 14)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mCategory Load (7.7ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 30) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 11 AND 12 THEN `lft` + 13 - 12 WHEN `lft` BETWEEN 13 AND 13 THEN `lft` + 11 - 13 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 11 AND 12 THEN `rgt` + 13 - 12 WHEN `rgt` BETWEEN 13 AND 13 THEN `rgt` + 11 - 13 ELSE `rgt` END, `parent_id` = CASE WHEN id = 6 THEN 30 ELSE `parent_id` END 
  [1m[36mSQL (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 30) LIMIT 1
  [1m[36mCategory Load (0.2ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mSQL (0.6ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET `lft` = CASE WHEN `lft` BETWEEN 3 AND 3 THEN `lft` + 7 - 3 WHEN `lft` BETWEEN 4 AND 7 THEN `lft` + 3 - 4 ELSE `lft` END, `rgt` = CASE WHEN `rgt` BETWEEN 3 AND 3 THEN `rgt` + 7 - 3 WHEN `rgt` BETWEEN 4 AND 7 THEN `rgt` + 3 - 4 ELSE `rgt` END, `parent_id` = CASE WHEN id = 3 THEN 2 ELSE `parent_id` END [0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 2) LIMIT 1[0m
  [1m[35mCategory Load (0.2ms)[0m  SELECT `lft`, `rgt`, `parent_id` FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  DELETE FROM `categories` WHERE (`categories`.`id` = 3)
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `categories` SET lft = null [0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mSQL (1.6ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.5ms)[0m  [1mUPDATE `categories` SET rgt = null [0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1
  [1m[36mSQL (7.4ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 6) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `categories` SET `lft` = 0 WHERE (`categories`.`id` = 6)[0m
  [1m[35mSQL (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mCategory Load (0.7ms)[0m  [1mSELECT `categories`.`id` FROM `categories` LEFT OUTER JOIN `categories` AS parent ON `categories`.`parent_id` = parent.id WHERE (`categories`.`lft` IS NULL OR `categories`.`rgt` IS NULL OR `categories`.`lft` >= `categories`.`rgt` OR (`categories`.`parent_id` IS NOT NULL AND (`categories`.`lft` <= parent.`lft` OR `categories`.`rgt` >= parent.`rgt`))) LIMIT 1[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `lft`, COUNT(`lft`) FROM `categories` GROUP BY `lft`
 HAVING COUNT(`lft`) > 1 LIMIT 1
  [1m[36mCategory Load (0.3ms)[0m  [1mSELECT `rgt`, COUNT(`rgt`) FROM `categories` GROUP BY `rgt`
 HAVING COUNT(`rgt`) > 1 LIMIT 1[0m
  [1m[35mCategory Load (0.3ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`
  [1m[36mSQL (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.4ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.7ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 2)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 4 AND `categories`.`rgt` >= 7) AND (`categories`.id != 3)
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 5 AND `categories`.`rgt` >= 6) AND (`categories`.id != 4)[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 8 AND `categories`.`rgt` >= 9) AND (`categories`.id != 5)
  [1m[36mCategory Load (0.4ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 11 AND `categories`.`rgt` <= 12) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mCategory Load (0.5ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`id` = 3) LIMIT 1
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`parent_id` IS NULL) ORDER BY `lft`[0m
  [1m[35mCategory Load (0.1ms)[0m  SELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 1 AND `categories`.`rgt` <= 10) ORDER BY `categories`.`lft`
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 2 AND `categories`.`rgt` >= 3) AND (`categories`.id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) AS count_id FROM `categories` WHERE (`categories`.`lft` <= 8 AND `categories`.`rgt` >= 9) AND (`categories`.id != 5)
  [1m[36mCategory Load (0.1ms)[0m  [1mSELECT `categories`.* FROM `categories` WHERE (`categories`.`lft` >= 11 AND `categories`.`rgt` <= 12) ORDER BY `categories`.`lft`[0m
  [1m[35mSQL (0.1ms)[0m  ROLLBACK
